!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=92)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]},e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===i.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Message=class{constructor(t,e){this.text=t,this.color=e}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(8),r=n(9),o=n(15),s=n(35),a=n(21),c=n(63),u=n(62),h=n(61),l=n(19);e.container=new i.Container,e.container.bind("ComponentService").toConstantValue(new r.ComponentService),e.container.bind("EntityService").toConstantValue(new o.EntityService),e.container.bind("SystemService").toConstantValue(new l.SystemService),e.container.bind("MapService").toConstantValue(new a.MapService),e.container.bind("FovService").toConstantValue(new s.FovService(e.container.get("MapService")));const p=e.container.get("SystemService");p.addSystem(e.container.resolve(c.AiSystem)),p.addSystem(e.container.resolve(u.FighterSystem)),p.addSystem(e.container.resolve(h.LevelSystem))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(0);function o(t,e,n,r,o){var s={},a="number"==typeof o,c=void 0!==o&&a?o.toString():n;if(a&&void 0!==n)throw new Error(i.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(s=Reflect.getMetadata(t,e));var u=s[c];if(Array.isArray(u))for(var h=0,l=u;h<l.length;h++){var p=l[h];if(p.key===r.key)throw new Error(i.DUPLICATED_METADATA+" "+p.key)}else u=[];u.push(r),s[c]=u,Reflect.defineMetadata(t,s,e)}function s(t,e){Reflect.decorate(t,e)}e.tagParameter=function(t,e,n,i){o(r.TAGGED,t,e,i,n)},e.tagProperty=function(t,e,n){o(r.TAGGED_PROP,t.constructor,e,n)},e.decorate=function(t,e,n){"number"==typeof n?s([function(t,e){return function(n,i){e(n,i,t)}}(n,t)],e):"string"==typeof n?Reflect.decorate([t],e,n):s([t],e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.guid=function(){function t(){return Math.floor(65536*(Math.random()+1)).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.METADATA_KEY=i;var r=n(89);e.Container=r.Container;var o=n(4);e.BindingScopeEnum=o.BindingScopeEnum,e.BindingTypeEnum=o.BindingTypeEnum,e.TargetTypeEnum=o.TargetTypeEnum;var s=n(73);e.AsyncContainerModule=s.AsyncContainerModule,e.ContainerModule=s.ContainerModule;var a=n(72);e.injectable=a.injectable;var c=n(71);e.tagged=c.tagged;var u=n(70);e.named=u.named;var h=n(39);e.inject=h.inject,e.LazyServiceIdentifer=h.LazyServiceIdentifer;var l=n(69);e.optional=l.optional;var p=n(68);e.unmanaged=p.unmanaged;var d=n(67);e.multiInject=d.multiInject;var f=n(66);e.targetName=f.targetName;var _=n(65);e.postConstruct=_.postConstruct;var g=n(41);e.MetadataReader=g.MetadataReader;var y=n(7);e.guid=y.guid;var m=n(6);e.decorate=m.decorate;var v=n(36);e.traverseAncerstors=v.traverseAncerstors,e.taggedConstraint=v.taggedConstraint,e.namedConstraint=v.namedConstraint,e.typeConstraint=v.typeConstraint;var T=n(10);e.getServiceIdentifierAsString=T.getServiceIdentifierAsString;var S=n(64);e.multiBindToService=S.multiBindToService},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ComponentService=class{constructor(){this.components=[]}addComponent(t){this.components.push(t)}deleteComponentById(t){this.components=this.components.filter(e=>e.id!==t)}deleteComponentByOwnerIdAndType(t,e){this.components=this.components.filter(n=>n.ownerId!==t||n.type!==e)}getComponentById(t){return this.components.find(e=>e.id===t)}getComponentByEntityIdAndType(t,e){const n=this.components.filter(n=>n.ownerId===t&&n.type===e);return 0===n.length?null:n[0]}getComponentsForEntityId(t){return this.components.filter(e=>e.ownerId===t)}getComponentsForEntityIdAndType(t,e){return this.components.filter(n=>n.ownerId===t&&n.type===e)}getComponentsForEntityIdAndTypes(t,e){return this.components.filter(n=>n.ownerId===t&&e.includes(n.type))}entityHasComponentOfType(t,e){return this.components.some(n=>n.ownerId===t&&n.type===e)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);function r(t){return"function"==typeof t?t.name:"symbol"==typeof t?t.toString():t}function o(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=r,e.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var i="",r=n(t,e);return 0!==r.length&&(i="\nRegistered bindings:",r.forEach(function(t){var e="Object";null!==t.implementationType&&(e=o(t.implementationType)),i=i+"\n "+e,t.constraint.metaData&&(i=i+" - "+t.constraint.metaData)})),i},e.circularDependencyToException=function t(e){e.childRequests.forEach(function(e){if(function t(e,n){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===n||t(e.parentRequest,n))}(e,e.serviceIdentifier)){var n=function(t){return function t(e,n){void 0===n&&(n=[]);var i=r(e.serviceIdentifier);return n.push(i),null!==e.parentRequest?t(e.parentRequest,n):n}(t).reverse().join(" --\x3e ")}(e);throw new Error(i.CIRCULAR_DEPENDENCY+" "+n)}t(e)})},e.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var n="",i=e.getNamedTag(),r=e.getCustomTags();return null!==i&&(n+=i.toString()+"\n"),null!==r&&r.forEach(function(t){n+=t.toString()+"\n"})," "+t+"\n "+t+" - "+n}return" "+t},e.getFunctionName=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(16),r=n(90),o=n(60),s=n(33),a=n(24),c=n(5),u=n(59),h=n(58),l=n(57),p=n(17),d=n(26),f=n(12),_=n(34),g=n(50),y=n(49),m=n(18),v=n(48),T=n(46),S=n(45),w=n(3),E=n(25),M=n(13),b=n(44),A=n(32);e.CONSTANTS={BAR_WIDTH:20,MAP_HEIGHT:43,MAP_WIDTH:80,MESSAGE_HEIGHT:6,MESSAGE_WIDTH:58,MESSAGE_X:22,PANEL_HEIGHT:7,PLAYER_FOV:10,SCREEN_HEIGHT:50,SCREEN_WIDTH:80,TOUCH_MOVE_REPEAT_DELAY:300};const C=["Load Game","New Game"],O=[i.VK_LEFT,i.VK_UP,i.VK_RIGHT,i.VK_DOWN,i.VK_H,i.VK_K,i.VK_L,i.VK_J,i.VK_Y,i.VK_U,i.VK_B,i.VK_N,i.VK_G,i.VK_I,i.VK_D,i.VK_C,i.VK_Z,i.VK_ESCAPE,i.VK_RETURN];let N,I,R,x,P=m.GameState.MAIN_MENU,D="",k=0,V=new E.MessageLog(e.CONSTANTS.MESSAGE_X,e.CONSTANTS.MESSAGE_HEIGHT,e.CONSTANTS.MESSAGE_WIDTH),L=null,G=null,F=!1;const B=c.container.get("ComponentService"),j=c.container.get("EntityService"),U=c.container.get("FovService"),K=c.container.get("MapService"),H=c.container.get("SystemService");function W(t){for(const e of t){if(e.message&&V.addMessage(e.message),e.dead){let t=null;if(e.dead===L){const n=u.killPlayer(e.dead);t=n.message,P=n.state}else{t=u.killMonster(e.dead).message}V.addMessage(t)}if(e.equip){const t=d.Equipment.toggleEquip(L.equipment,e.equip.equippable);for(const e of t)e.dequipped&&V.addMessage(new w.Message(`You unequip the ${e.dequipped.name}.`,"white")),e.equipped&&V.addMessage(new w.Message(`You equip the ${e.equipped.name}.`,"white"))}if(e.itemAdded&&(e.itemAdded.isActive=!1),e.itemDropped&&(e.itemDropped.isActive=!0),e.targeting&&(G=m.GameState.PLAYER_TURN,P=m.GameState.TARGETING,R=[L.x,L.y]),e.xp){V.addMessage(new w.Message(`You gain ${e.xp} experience points.`,"white")),H.dispatchEvent(L.id,new g.GainXpEvent(e.xp)).some(t=>t.leveledUp)&&(V.addMessage(new w.Message("You have leveled up!","yellow")),G=P,P=m.GameState.LEVEL_UP,k=0)}}}function Y(t,n){const i=document.querySelector("body");i.style.height=window.innerHeight+"px",i.style.widows=window.innerWidth+"px";const r=document.getElementById("grid"),o=document.getElementById("touch-icons");navigator&&(navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0||/iPad|iPhone|iPod/.test(navigator.platform))?(F=!0,r.style.display="grid",o.style.display="block"):(F=!1,r.style.display="none",o.style.display="none");const s=Math.floor(window.innerHeight*e.CONSTANTS.SCREEN_HEIGHT/(e.CONSTANTS.SCREEN_HEIGHT+e.CONSTANTS.PANEL_HEIGHT)),[a,c]=t.computeSize(window.innerWidth,s);t.setOptions({height:c,width:a});const[u,h]=t.computeSize(window.innerWidth,window.innerHeight-s);n.setOptions({height:h,width:u}),V.height=h-1}function q(t,n,i){if(F&&h.drawTouchIcons(P,L,Q),P===m.GameState.MAIN_MENU)return t.clear(),n.clear(),void S.menu(t,"Main Menu",C,k,e.CONSTANTS.SCREEN_WIDTH,e.CONSTANTS.SCREEN_WIDTH,e.CONSTANTS.SCREEN_HEIGHT);if(function(t,n){t.clear();const i=n.x,r=n.y,s=Math.floor(t.getOptions().width/2),a=Math.floor(t.getOptions().height/2);for(let n=0;n<e.CONSTANTS.MAP_WIDTH;++n)for(let c=0;c<e.CONSTANTS.MAP_HEIGHT;++c){const e=n-i+s,u=c-r+a,h=K.getCurrentMap().getTile(n,c);h.isSeen&&(h.blocksSight?t.draw(e,u,"",null,o.COLORS.darkWall):t.draw(e,u,"",null,o.COLORS.darkGround))}const c=[];U.computeFov(n.x,n.y,e.CONSTANTS.PLAYER_FOV,(e,n)=>{c.push([e,n]);const u=e-i+s,h=n-r+a,l=K.getCurrentMap().getTile(e,n);l.isSeen=!0,l.blocksSight?t.draw(u,h,"",null,o.COLORS.lightWall):P===m.GameState.TARGETING&&R[0]===e&&R[1]===n?t.draw(u,h,"",null,"red"):t.draw(u,h,"",null,o.COLORS.lightGround);const p=j.getEntitiesAtPos(e,n).sort(t=>t.renderOrder);if(p.length>0){const i=p[p.length-1];P===m.GameState.TARGETING&&R[0]===e&&R[1]===n?t.draw(u,h,i.symbol,i.color,"red"):t.draw(u,h,i.symbol,i.color,o.COLORS.lightGround)}}),j.entities.filter(t=>t.stairs).forEach(e=>{const n=e.x-i+s,u=e.y-r+a,h=K.getCurrentMap().getTile(e.x,e.y);h.isSeen&&(c.some(t=>t[0]===e.x&&t[1]===e.y)||t.draw(n,u,e.symbol,e.color,o.COLORS.darkGround))}),t.draw(s,a,n.symbol,n.color,o.COLORS.lightGround)}(t,i),P===m.GameState.LEVEL_UP){const n=B.getComponentByEntityIdAndType(L.id,"FighterComponent");S.menu(t,"Level up! Choose a stat to raise:",[`HP +20 (current: ${n.baseMaxHp})`,`Attack +1 (current: ${n.basePower})`,`Defense +1 (current: ${n.baseDefense})`],k,40,e.CONSTANTS.SCREEN_WIDTH,e.CONSTANTS.SCREEN_HEIGHT)}else P===m.GameState.SHOW_CHARACTER_PANEL?r.characterScreen(t,L,50,e.CONSTANTS.SCREEN_WIDTH,e.CONSTANTS.SCREEN_HEIGHT):P===m.GameState.SHOW_INVENTORY&&S.menu(t,"Inventory",L.inventory.items.map(t=>t.equippable&&L.equipment.equipped.includes(t.equippable)?t.name+` (on ${f.EQUIPMENTSLOTSTRINGS[t.equippable.slot]})`:t.name),k,50,e.CONSTANTS.SCREEN_WIDTH,e.CONSTANTS.SCREEN_HEIGHT);z(n,i,D)}function z(t,n,i){if(t.clear(),n){const i=B.getComponentByEntityIdAndType(n.id,"FighterComponent");!function(t,e,n,i,r,o,s,a,c){const u=Math.floor(o/s*i);for(let r=0;r<i;++r)t.draw(e+r,n,"",null,r<u?a:c);const h=`${r}: ${o}/${s}`;t.drawText(Math.floor(e+i/2-h.length/2),n,h)}(t,1,1,e.CONSTANTS.BAR_WIDTH,"HP",i.currHp,i.baseMaxHp,"red","darkred")}!function(t,e){let n=1;for(const i of e.messages)t.drawText(V.x,n,`%c{${i.color}}${i.text}`,V.width),n++}(t,V),i&&t.drawText(1,0,i),t.drawText(1,2,`Floor: ${K.getCurrentMap().dungeonLevel}`)}function X(t){const e=t.keyCode;if(-1===O.indexOf(e))return;t.preventDefault();let n=null;switch(e){case i.VK_LEFT:case i.VK_H:n={type:"move",dir:[-1,0]};break;case i.VK_UP:case i.VK_K:n={type:"move",dir:[0,-1]};break;case i.VK_RIGHT:case i.VK_L:n={type:"move",dir:[1,0]};break;case i.VK_DOWN:case i.VK_J:n={type:"move",dir:[0,1]};break;case i.VK_Y:n={type:"move",dir:[-1,-1]};break;case i.VK_U:n={type:"move",dir:[1,-1]};break;case i.VK_B:n={type:"move",dir:[-1,1]};break;case i.VK_N:n={type:"move",dir:[1,1]};break;case i.VK_G:n={type:"pickup"};break;case i.VK_I:n={type:"open-inventory"};break;case i.VK_D:n={type:"drop"};break;case i.VK_C:n={type:"open-character-panel"};break;case i.VK_Z:n={type:"wait"};break;case i.VK_ESCAPE:n={type:"exit"};break;case i.VK_RETURN:n={type:"enter"}}Q(n)}function $(t){const n=N.eventToPosition(t);if("number"==typeof n)return;const i=Math.floor(N.getOptions().width/2),r=Math.floor(N.getOptions().height/2),o=j.entities.filter(t=>{const e=t.x-L.x+i,o=t.y-L.y+r;return t.isActive&&e===n[0]&&o===n[1]}).sort(t=>t.renderOrder);let s="";if(o.length>0){const t=o[o.length-1];U.computeFov(L.x,L.y,e.CONSTANTS.PLAYER_FOV,(e,n)=>{t.x===e&&t.y===n&&(s=t.name)})}D=s,P!==m.GameState.MAIN_MENU&&z(I,L,s)}function J(t){if(t.preventDefault(),t.touches&&t.touches.length>0){const n=t.touches[0];let i=null,r=!1;const o=[0,0];n.clientX<window.innerWidth/3?(r=!0,o[0]--):n.clientX>window.innerWidth/3*2&&(r=!0,o[0]++),n.clientY<window.innerHeight/3?(r=!0,o[1]--):n.clientY>window.innerHeight/3*2&&(r=!0,o[1]++),r?(i={type:"move",dir:o},x&&(window.clearInterval(x),x=null),x=window.setInterval(()=>{Q(i)},e.CONSTANTS.TOUCH_MOVE_REPEAT_DELAY)):i=j.entities.some(t=>t.isActive&&t.item&&t.x===L.x&&t.y===L.y)?{type:"pickup"}:P===m.GameState.MAIN_MENU||P===m.GameState.SHOW_INVENTORY||P===m.GameState.TARGETING||P===m.GameState.LEVEL_UP||j.entities.some(t=>t.isActive&&t.stairs&&t.x===L.x&&t.y===L.y)?{type:"enter"}:{type:"open-inventory"},i&&Q(i)}}function Q(t){if(P===m.GameState.ENEMY_TURN)return;let n=[];if(P===m.GameState.LEVEL_UP){if("move"===t.type)(k+=t.dir[1])<0?k=0:k>=3&&(k=2);else if("enter"===t.type){const t=B.getComponentByEntityIdAndType(L.id,"FighterComponent");0===k?(t.baseMaxHp+=20,t.currHp+=20):1===k?t.basePower+=1:2===k&&(t.baseDefense+=1),P=m.GameState.PLAYER_TURN}}else if(P===m.GameState.MAIN_MENU){if("move"===t.type)(k+=t.dir[1])<0?k=0:k>=C.length&&(k=C.length-1);else if("enter"===t.type)switch(C[k]){case"New Game":j.clearEntities(),L=new p.Entity(0,e.CONSTANTS.SCREEN_WIDTH,e.CONSTANTS.SCREEN_HEIGHT,"white","私",!0,"Player",M.RenderOrder.ACTOR,null,new v.Inventory(26),null,new d.Equipment),j.addEntity(L),B.addComponent(new s.FighterComponent(L.id,100,1,2)),B.addComponent(new a.LevelComponent(L.id)),P=m.GameState.PLAYER_TURN,K.addMap(new A.TutorialMapGenerator(j,B).generate({height:e.CONSTANTS.MAP_HEIGHT,width:e.CONSTANTS.MAP_WIDTH},L,1)),V=new E.MessageLog(e.CONSTANTS.MESSAGE_X,e.CONSTANTS.MESSAGE_HEIGHT,e.CONSTANTS.MESSAGE_WIDTH);break;case"Load Game":{const t=localStorage.getItem("savedGame");if(t){const e=JSON.parse(t),n=T.loadGame(e);for(const t of n.entities)j.addEntity(t);for(const t of n.gameMaps){const e=t.id;K.addMap(t),n.currentMap===e&&K.setCurrentMap(t.id)}P=n.gameState,V=n.messageLog,L=n.player}break}}}else if(P===m.GameState.PLAYER_TURN)if("move"===t.type){let e=null;{const n=j.getEntitiesAtPos(L.x+t.dir[0],L.y+t.dir[1]);n.length>0&&(e=n[0])}e&&(n=n.concat(H.dispatchEvent(e.id,new _.AttackEvent(L.id)))),K.getCurrentMap().isBlocked(L.x+t.dir[0],L.y+t.dir[1])||e&&e.isBlocking||(L.x+=t.dir[0],L.y+=t.dir[1]),P=m.GameState.ENEMY_TURN}else if("pickup"===t.type){const t=j.getEntitiesAtPos(L.x,L.y).filter(t=>t.item||t.equippable);t.length>0?n=n.concat(L.inventory.addItem(t[0])):V.addMessage(new w.Message("There is nothing here to pick up.","yellow")),P=m.GameState.ENEMY_TURN}else if("open-character-panel"===t.type)G=P,P=m.GameState.SHOW_CHARACTER_PANEL;else if("open-inventory"===t.type)G=P,k=0,P=m.GameState.SHOW_INVENTORY;else if("exit"===t.type)b.saveGame(L,j.entities,K.maps,K.getCurrentMapId(),V,P),k=0,P=m.GameState.MAIN_MENU,j.clearEntities(),K.clearMaps();else if("enter"===t.type){const t=j.getEntitiesAtPos(L.x,L.y).filter(t=>t.stairs);if(t.length>0){let e=K.getCurrentMapId();e=l.enterStairs(t[0].stairs,L,K.maps,V,new A.TutorialMapGenerator(j,B),K.getCurrentMapId()+1),K.setCurrentMap(e)}}else"wait"===t.type&&(V.addMessage(new w.Message("You wait for a moment.","white")),P=m.GameState.ENEMY_TURN);else P===m.GameState.PLAYER_DEAD?"open-inventory"===t.type&&(G=P,k=0,P=m.GameState.SHOW_INVENTORY):P===m.GameState.SHOW_CHARACTER_PANEL?"exit"===t.type&&(P=G):P===m.GameState.SHOW_INVENTORY?"exit"===t.type?P=G:"move"===t.type?(k+=t.dir[1])<0?k=0:k>=L.inventory.items.length&&(k=L.inventory.items.length-1):"enter"===t.type?(n=n.concat(L.inventory.useItem(k,j.entities,U)),k>=L.inventory.items.length&&(k=L.inventory.items.length-1)):"drop"===t.type&&(n=n.concat(L.inventory.dropItem(k,j.entities)),k>=L.inventory.items.length&&(k=L.inventory.items.length-1)):P===m.GameState.TARGETING&&("move"===t.type?K.getCurrentMap().getTile(R[0]+t.dir[0],R[1]+t.dir[1]).blocksSight||(R[0]+=t.dir[0],R[1]+=t.dir[1]):"enter"===t.type?(n=n.concat(L.inventory.useItem(k,j.entities,U,R[0],R[1])),k>=L.inventory.items.length&&(k=L.inventory.items.length-1),P=G):"exit"===t.type&&(P=G));W(n),q(N,I,L),function(){if(P!==m.GameState.ENEMY_TURN)return;let t=[];for(const e of j.entities)t=t.concat(H.dispatchEvent(e.id,new y.ThinkEvent));P=m.GameState.PLAYER_TURN,W(t),q(N,I,L)}()}e.main=function(){if(!i.isSupported())throw new Error("ERROR: ROT.js is not supported by this browser!");const t=document.getElementById("app");N=new i.Display({fontSize:20,forceSquareRatio:!0,height:e.CONSTANTS.SCREEN_HEIGHT,width:e.CONSTANTS.SCREEN_WIDTH}),t.appendChild(N.getContainer()),I=new i.Display({fontSize:20,forceSquareRatio:!0,height:e.CONSTANTS.PANEL_HEIGHT,width:e.CONSTANTS.SCREEN_WIDTH}),t.appendChild(I.getContainer()),Y(N,I),window.onkeydown=X,window.onmousemove=$,window.onresize=(()=>{Y(N,I),q(N,I,L)}),document.getElementById("touch-icons").ontouchstart=(t=>t.stopPropagation()),window.ontouchstart=J,window.ontouchend=(t=>{t.preventDefault(),x&&(window.clearInterval(x),x=null)}),q(N,I,L)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.MAIN_HAND=0]="MAIN_HAND",t[t.OFF_HAND=1]="OFF_HAND",t[t.COUNT=2]="COUNT"}(e.EquipmentSlot||(e.EquipmentSlot={})),e.EQUIPMENTSLOTSTRINGS=["Main Hand","Off Hand"];class i{constructor(t,e,n,i){this.slot=t,this.powerBonus=e,this.defenseBonus=n,this.maxHpBonus=i}static fromOtherEquippable(t){return new i(t.slot,t.powerBonus,t.defenseBonus,t.maxHpBonus)}toJSON(){const t=Object.assign({},this);return t._ownerId=t.owner.id,t.owner=void 0,t._type="Equippable",t}}e.Equippable=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.STAIRS=0]="STAIRS",t[t.CORPSE=1]="CORPSE",t[t.ITEM=2]="ITEM",t[t.ACTOR=3]="ACTOR"}(e.RenderOrder||(e.RenderOrder={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.TakeDamageEvent=class{constructor(t){this.damage=t,this.type="TakeDamageEvent"}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.EntityService=class{constructor(){this.entities=[]}addEntity(t){if(this.entities.some(e=>e.id===t.id))throw new Error(`An Entity with ID === ${t.id} already exists!`);this.entities.push(t)}clearEntities(){this.entities=[]}deleteEntityById(t){this.entities=this.entities.filter(e=>e.id!==t)}getEntityById(t){return this.entities.find(e=>e.id===t)}getEntityByName(t){return this.entities.find(e=>e.name===t)}getEntitiesAtPos(t,e){return this.entities.filter(n=>n.isActive&&n.x===t&&n.y===e)}}},function(t,e,n){(function(n,i){var r,o,s;n.requestAnimationFrame=function(t){return setTimeout(function(){t(Date.now())},1e3/60)},n.document={body:{appendChild:function(t){},scrollLeft:0,scrollTop:0},createElement:function(t){var e;return e={getBoundingClientRect:function(){return{left:0,top:0}},getContext:function(t){return{_termcolor:null,beginPath:function(){},canvas:e,clearRect:function(t,e,n,r){if(null!==this._termcolor){var o=this._termcolor.clearToAnsi(this.fillStyle);i.stdout.write(o)}},drawImage:function(t,e,n,i,r,o,s,a,c){},fill:function(){},fillRect:function(t,e,n,r){if(null!==this._termcolor){var o=this._termcolor.clearToAnsi(this.fillStyle);i.stdout.write(o)}},fillStyle:"#000",fillText:function(t,e,n){},font:"monospace",lineTo:function(t,e){},measureText:function(t){return{width:12}},moveTo:function(t,e){},textAlign:"center",textBaseline:"middle"}},height:0,style:{left:"100px",position:"absolute",top:"100px",visibility:"hidden"},width:0}},documentElement:{scrollLeft:0,scrollTop:0}},o=[],void 0===(s="function"==typeof(r=function(){var t={isSupported:function(){return!(!document.createElement("canvas").getContext||!Function.prototype.bind)},DEFAULT_WIDTH:80,DEFAULT_HEIGHT:25,DIRS:{4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};for(var n in t.Text={RE_COLORS:/%([bc]){([^}]*)}/g,TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(t,e){for(var n={width:0,height:1},i=this.tokenize(t,e),r=0,o=0;o<i.length;o++){var s=i[o];switch(s.type){case this.TYPE_TEXT:r+=s.value.length;break;case this.TYPE_NEWLINE:n.height++,n.width=Math.max(n.width,r),r=0}}return n.width=Math.max(n.width,r),n},tokenize:function(e,n){var i=[],r=0;e.replace(this.RE_COLORS,function(n,o,s,a){var c=e.substring(r,a);return c.length&&i.push({type:t.Text.TYPE_TEXT,value:c}),i.push({type:"c"==o?t.Text.TYPE_FG:t.Text.TYPE_BG,value:s.trim()}),r=a+n.length,""});var o=e.substring(r);return o.length&&i.push({type:t.Text.TYPE_TEXT,value:o}),this._breakLines(i,n)},_breakLines:function(e,n){n||(n=1/0);for(var i=0,r=0,o=-1;i<e.length;)if((l=e[i]).type==t.Text.TYPE_NEWLINE&&(r=0,o=-1),l.type==t.Text.TYPE_TEXT){for(;0==r&&" "==l.value.charAt(0);)l.value=l.value.substring(1);if(-1!=(a=l.value.indexOf("\n"))){l.value=this._breakInsideToken(e,i,a,!0);for(var s=l.value.split("");s.length&&" "==s[s.length-1];)s.pop();l.value=s.join("")}if(l.value.length){if(r+l.value.length>n){for(var a=-1;;){var c=l.value.indexOf(" ",a+1);if(-1==c)break;if(r+c>n)break;a=c}if(-1!=a)l.value=this._breakInsideToken(e,i,a,!0);else if(-1!=o){var u=(l=e[o]).value.lastIndexOf(" ");l.value=this._breakInsideToken(e,o,u,!0),i=o}else l.value=this._breakInsideToken(e,i,n-r,!1)}else r+=l.value.length,-1!=l.value.indexOf(" ")&&(o=i);i++}else e.splice(i,1)}else i++;e.push({type:t.Text.TYPE_NEWLINE});var h=null;for(i=0;i<e.length;i++){var l;switch((l=e[i]).type){case t.Text.TYPE_TEXT:h=l;break;case t.Text.TYPE_NEWLINE:if(h){for(s=h.value.split("");s.length&&" "==s[s.length-1];)s.pop();h.value=s.join("")}h=null}}return e.pop(),e},_breakInsideToken:function(e,n,i,r){var o={type:t.Text.TYPE_NEWLINE},s={type:t.Text.TYPE_TEXT,value:e[n].value.substring(i+(r?1:0))};return e.splice(n+1,0,o,s),e[n].value.substring(0,i)}},Array.prototype.random=Array.prototype.random||function(){return this.length?this[Math.floor(t.RNG.getUniform()*this.length)]:null},Array.prototype.randomize=Array.prototype.randomize||function(){for(var t=[],e=this.slice();e.length;){var n=e.indexOf(e.random());t.push(e.splice(n,1)[0])}return t},Number.prototype.mod=Number.prototype.mod||function(t){return(this%t+t)%t},String.prototype.capitalize=String.prototype.capitalize||function(){return this.charAt(0).toUpperCase()+this.substring(1)},String.prototype.lpad=String.prototype.lpad||function(t,e){for(var n=t||"0",i=e||2,r="";r.length<i-this.length;)r+=n;return(r=r.substring(0,i-this.length))+this},String.prototype.rpad=String.prototype.rpad||function(t,e){for(var n=t||"0",i=e||2,r="";r.length<i-this.length;)r+=n;return this+(r=r.substring(0,i-this.length))},String.format=String.format||function(t){var e=String.format.map,n=Array.prototype.slice.call(arguments,1);return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(i,r,o,s){if("%"==t.charAt(s-1))return i.substring(1);if(!n.length)return i;var a=n[0],c=(r||o).split(","),u=c.shift(),h=e[u.toLowerCase()];if(!h)return i;var l=(a=n.shift())[h].apply(a,c),p=u.charAt(0);return p!=p.toLowerCase()&&(l=l.capitalize()),l})},String.format.map=String.format.map||{s:"toString"},String.prototype.format=String.prototype.format||function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),String.format.apply(String,t)},Object.create||(Object.create=function(t){var e=function(){};return e.prototype=t,new e}),Function.prototype.extend=Function.prototype.extend||function(t){return this.prototype=Object.create(t.prototype),this.prototype.constructor=this,this},"undefined"!=typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(function(){t(Date.now())},1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){return clearTimeout(t)}),t.Display=function(e){var n=document.createElement("canvas");this._context=n.getContext("2d"),this._data={},this._dirty=!1,this._options={},this._backend=null;var i={width:t.DEFAULT_WIDTH,height:t.DEFAULT_HEIGHT,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1,termColor:"xterm"};for(var r in e)i[r]=e[r];this.setOptions(i),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),requestAnimationFrame(this._tick)},t.Display.prototype.DEBUG=function(t,e,n){var i=[this._options.bg,this._options.fg];this.draw(t,e,null,null,i[n%i.length])},t.Display.prototype.clear=function(){this._data={},this._dirty=!0},t.Display.prototype.setOptions=function(e){for(var n in e)this._options[n]=e[n];if(e.width||e.height||e.fontSize||e.fontFamily||e.spacing||e.layout){e.layout&&(this._backend=new(t.Display[e.layout.capitalize()])(this._context));var i=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily;this._context.font=i,this._backend.compute(this._options),this._context.font=i,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=!0}return this},t.Display.prototype.getOptions=function(){return this._options},t.Display.prototype.getContainer=function(){return this._context.canvas},t.Display.prototype.computeSize=function(t,e){return this._backend.computeSize(t,e,this._options)},t.Display.prototype.computeFontSize=function(t,e){return this._backend.computeFontSize(t,e,this._options)},t.Display.prototype.eventToPosition=function(t){if(t.touches)var e=t.touches[0].clientX,n=t.touches[0].clientY;else e=t.clientX,n=t.clientY;var i=this._context.canvas.getBoundingClientRect();return e-=i.left,n-=i.top,e*=this._context.canvas.width/this._context.canvas.clientWidth,n*=this._context.canvas.height/this._context.canvas.clientHeight,e<0||n<0||e>=this._context.canvas.width||n>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(e,n)},t.Display.prototype.draw=function(t,e,n,i,r){i||(i=this._options.fg),r||(r=this._options.bg),this._data[t+","+e]=[t,e,n,i,r],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[t+","+e]=!0)},t.Display.prototype.drawText=function(e,n,i,r){var o=null,s=null,a=e,c=n,u=1;r||(r=this._options.width-e);for(var h=t.Text.tokenize(i,r);h.length;){var l=h.shift();switch(l.type){case t.Text.TYPE_TEXT:for(var p=!1,d=!1,f=!1,_=!1,g=0;g<l.value.length;g++){var y=l.value.charCodeAt(g),m=l.value.charAt(g);f=y>65280&&y<65377||y>65500&&y<65512||y>65518,p=32==m.charCodeAt(0)||12288==m.charCodeAt(0),!_||f||p||a++,f&&!d&&a++,this.draw(a++,c,m,o,s),d=p,_=f}break;case t.Text.TYPE_FG:o=l.value||null;break;case t.Text.TYPE_BG:s=l.value||null;break;case t.Text.TYPE_NEWLINE:a=e,c++,u++}}return u},t.Display.prototype._tick=function(){if(requestAnimationFrame(this._tick),this._dirty){if(!0===this._dirty)for(var t in this._context.fillStyle=this._options.bg,this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height),this._data)this._draw(t,!1);else for(var e in this._dirty)this._draw(e,!0);this._dirty=!1}},t.Display.prototype._draw=function(t,e){var n=this._data[t];n[4]!=this._options.bg&&(e=!0),this._backend.draw(n,e)},t.Display.Backend=function(t){this._context=t},t.Display.Backend.prototype.compute=function(t){},t.Display.Backend.prototype.draw=function(t,e){},t.Display.Backend.prototype.computeSize=function(t,e){},t.Display.Backend.prototype.computeFontSize=function(t,e){},t.Display.Backend.prototype.eventToPosition=function(t,e){},t.Display.Rect=function(e){t.Display.Backend.call(this,e),this._spacingX=0,this._spacingY=0,this._canvasCache={},this._options={}},t.Display.Rect.extend(t.Display.Backend),t.Display.Rect.cache=!1,t.Display.Rect.prototype.compute=function(t){this._canvasCache={},this._options=t;var e=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),this._options.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._context.canvas.width=t.width*this._spacingX,this._context.canvas.height=t.height*this._spacingY},t.Display.Rect.prototype.draw=function(t,e){this.constructor.cache?this._drawWithCache(t,e):this._drawNoCache(t,e)},t.Display.Rect.prototype._drawWithCache=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=""+r+o+s;if(a in this._canvasCache)var c=this._canvasCache[a];else{var u=this._options.border,h=(c=document.createElement("canvas")).getContext("2d");if(c.width=this._spacingX,c.height=this._spacingY,h.fillStyle=s,h.fillRect(u,u,c.width-u,c.height-u),r){h.fillStyle=o,h.font=this._context.font,h.textAlign="center",h.textBaseline="middle";for(var l=[].concat(r),p=0;p<l.length;p++)h.fillText(l[p],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=c}this._context.drawImage(c,n*this._spacingX,i*this._spacingY)},t.Display.Rect.prototype._drawNoCache=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4];if(e){var a=this._options.border;this._context.fillStyle=s,this._context.fillRect(n*this._spacingX+a,i*this._spacingY+a,this._spacingX-a,this._spacingY-a)}if(r){this._context.fillStyle=o;for(var c=[].concat(r),u=0;u<c.length;u++)this._context.fillText(c[u],(n+.5)*this._spacingX,Math.ceil((i+.5)*this._spacingY))}},t.Display.Rect.prototype.computeSize=function(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]},t.Display.Rect.prototype.computeFontSize=function(t,e){var n=Math.floor(t/this._options.width),i=Math.floor(e/this._options.height),r=this._context.font;this._context.font="100px "+this._options.fontFamily;var o=Math.ceil(this._context.measureText("W").width);this._context.font=r;var s=o/100*i/n;return s>1&&(i=Math.floor(i/s)),Math.floor(i/this._options.spacing)},t.Display.Rect.prototype.eventToPosition=function(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]},t.Display.Hex=function(e){t.Display.Backend.call(this,e),this._spacingX=0,this._spacingY=0,this._hexSize=0,this._options={}},t.Display.Hex.extend(t.Display.Backend),t.Display.Hex.prototype.compute=function(t){this._options=t;var e=Math.ceil(this._context.measureText("W").width);if(this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose)var n="height",i="width";else n="width",i="height";this._context.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._context.canvas[i]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)},t.Display.Hex.prototype.draw=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=[(n+1)*this._spacingX,i*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),e&&(this._context.fillStyle=s,this._fill(a[0],a[1])),r){this._context.fillStyle=o;for(var c=[].concat(r),u=0;u<c.length;u++)this._context.fillText(c[u],a[0],Math.ceil(a[1]))}},t.Display.Hex.prototype.computeSize=function(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]},t.Display.Hex.prototype.computeFontSize=function(t,e){this._options.transpose&&(t+=e,t-=e=t-e);var n=2*t/((this._options.width+1)*Math.sqrt(3))-1,i=e/(2+1.5*(this._options.height-1)),r=Math.min(n,i),o=this._context.font;this._context.font="100px "+this._options.fontFamily;var s=Math.ceil(this._context.measureText("W").width);this._context.font=o;var a=s/100,c=2*(r=Math.floor(r)+1)/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(c)-1},t.Display.Hex.prototype.eventToPosition=function(t,e){if(this._options.transpose){t+=e,t-=e=t-e;var n=this._context.canvas.width}else n=this._context.canvas.height;var i=n/this._options.height;return(e=Math.floor(e/i)).mod(2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]},t.Display.Hex.prototype._fill=function(t,e){var n=this._hexSize,i=this._options.border;this._context.beginPath(),this._options.transpose?(this._context.moveTo(t-n+i,e),this._context.lineTo(t-n/2+i,e+this._spacingX-i),this._context.lineTo(t+n/2-i,e+this._spacingX-i),this._context.lineTo(t+n-i,e),this._context.lineTo(t+n/2-i,e-this._spacingX+i),this._context.lineTo(t-n/2+i,e-this._spacingX+i),this._context.lineTo(t-n+i,e)):(this._context.moveTo(t,e-n+i),this._context.lineTo(t+this._spacingX-i,e-n/2+i),this._context.lineTo(t+this._spacingX-i,e+n/2-i),this._context.lineTo(t,e+n-i),this._context.lineTo(t-this._spacingX+i,e+n/2-i),this._context.lineTo(t-this._spacingX+i,e-n/2+i),this._context.lineTo(t,e-n+i)),this._context.fill()},t.Display.Tile=function(e){t.Display.Rect.call(this,e),this._options={},this._colorCanvas=document.createElement("canvas")},t.Display.Tile.extend(t.Display.Rect),t.Display.Tile.prototype.compute=function(t){this._options=t,this._context.canvas.width=t.width*t.tileWidth,this._context.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight},t.Display.Tile.prototype.draw=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=this._options.tileWidth,c=this._options.tileHeight;if(e&&(this._options.tileColorize?this._context.clearRect(n*a,i*c,a,c):(this._context.fillStyle=s,this._context.fillRect(n*a,i*c,a,c))),r)for(var u=[].concat(r),h=0;h<u.length;h++){var l=this._options.tileMap[u[h]];if(!l)throw new Error("Char '"+u[h]+"' not found in tileMap");if(this._options.tileColorize){var p=this._colorCanvas,d=p.getContext("2d");d.clearRect(0,0,a,c),d.drawImage(this._options.tileSet,l[0],l[1],a,c,0,0,a,c),"transparent"!=o&&(d.fillStyle=o,d.globalCompositeOperation="source-atop",d.fillRect(0,0,a,c)),"transparent"!=s&&(d.fillStyle=s,d.globalCompositeOperation="destination-over",d.fillRect(0,0,a,c)),this._context.drawImage(p,n*a,i*c,a,c)}else this._context.drawImage(this._options.tileSet,l[0],l[1],a,c,n*a,i*c,a,c)}},t.Display.Tile.prototype.computeSize=function(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]},t.Display.Tile.prototype.computeFontSize=function(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]},t.Display.Tile.prototype.eventToPosition=function(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]},t.RNG={getSeed:function(){return this._seed},setSeed:function(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*this._frac,t=69069*t+1>>>0,this._s1=t*this._frac,t=69069*t+1>>>0,this._s2=t*this._frac,this._c=1,this},getUniform:function(){var t=2091639*this._s0+this._c*this._frac;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2},getUniformInt:function(t,e){var n=Math.max(t,e),i=Math.min(t,e);return Math.floor(this.getUniform()*(n-i+1))+i},getNormal:function(t,e){do{var n=2*this.getUniform()-1,i=2*this.getUniform()-1,r=n*n+i*i}while(r>1||0==r);var o=n*Math.sqrt(-2*Math.log(r)/r);return(t||0)+o*(e||1)},getPercentage:function(){return 1+Math.floor(100*this.getUniform())},getWeightedValue:function(t){var e=0;for(var n in t)e+=t[n];var i=this.getUniform()*e,r=0;for(var n in t)if(i<(r+=t[n]))return n;return n},getState:function(){return[this._s0,this._s1,this._s2,this._c]},setState:function(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this},clone:function(){var t=Object.create(this);return t.setState(this.getState()),t},_s0:0,_s1:0,_s2:0,_c:0,_frac:2.3283064365386963e-10},t.RNG.setSeed(Date.now()),t.StringGenerator=function(t){for(var e in this._options={words:!1,order:3,prior:.001},t)this._options[e]=t[e];this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(var n=0;n<this._options.order;n++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}},t.StringGenerator.prototype.clear=function(){this._data={},this._priorValues={}},t.StringGenerator.prototype.generate=function(){for(var t=[this._sample(this._prefix)];t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))},t.StringGenerator.prototype.observe=function(t){for(var e=this._split(t),n=0;n<e.length;n++)this._priorValues[e[n]]=this._options.prior;for(e=this._prefix.concat(e).concat(this._suffix),n=this._options.order;n<e.length;n++)for(var i=e.slice(n-this._options.order,n),r=e[n],o=0;o<i.length;o++){var s=i.slice(o);this._observeEvent(s,r)}},t.StringGenerator.prototype.getStats=function(){var t=[],e=0;for(var n in this._priorValues)e++;e--,t.push("distinct samples: "+e);var i=0,r=0;for(var n in this._data)for(var o in i++,this._data[n])r++;return t.push("dictionary size (contexts): "+i),t.push("dictionary size (events): "+r),t.join(", ")},t.StringGenerator.prototype._split=function(t){return t.split(this._options.words?/\s+/:"")},t.StringGenerator.prototype._join=function(t){return t.join(this._options.words?" ":"")},t.StringGenerator.prototype._observeEvent=function(t,e){var n=this._join(t);n in this._data||(this._data[n]={});var i=this._data[n];e in i||(i[e]=0),i[e]++},t.StringGenerator.prototype._sample=function(e){e=this._backoff(e);var n=this._join(e),i=this._data[n],r={};if(this._options.prior){for(var o in this._priorValues)r[o]=this._priorValues[o];for(var o in i)r[o]+=i[o]}else r=i;return t.RNG.getWeightedValue(r)},t.StringGenerator.prototype._backoff=function(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&t.length>0;)t=t.slice(1);return t},t.EventQueue=function(){this._time=0,this._events=[],this._eventTimes=[]},t.EventQueue.prototype.getTime=function(){return this._time},t.EventQueue.prototype.clear=function(){return this._events=[],this._eventTimes=[],this},t.EventQueue.prototype.add=function(t,e){for(var n=this._events.length,i=0;i<this._eventTimes.length;i++)if(this._eventTimes[i]>e){n=i;break}this._events.splice(n,0,t),this._eventTimes.splice(n,0,e)},t.EventQueue.prototype.get=function(){if(!this._events.length)return null;var t=this._eventTimes.splice(0,1)[0];if(t>0){this._time+=t;for(var e=0;e<this._eventTimes.length;e++)this._eventTimes[e]-=t}return this._events.splice(0,1)[0]},t.EventQueue.prototype.getEventTime=function(t){var e=this._events.indexOf(t);if(-1!=e)return this._eventTimes[e]},t.EventQueue.prototype.remove=function(t){var e=this._events.indexOf(t);return-1!=e&&(this._remove(e),!0)},t.EventQueue.prototype._remove=function(t){this._events.splice(t,1),this._eventTimes.splice(t,1)},t.Scheduler=function(){this._queue=new t.EventQueue,this._repeat=[],this._current=null},t.Scheduler.prototype.getTime=function(){return this._queue.getTime()},t.Scheduler.prototype.add=function(t,e){return e&&this._repeat.push(t),this},t.Scheduler.prototype.getTimeOf=function(t){return this._queue.getEventTime(t)},t.Scheduler.prototype.clear=function(){return this._queue.clear(),this._repeat=[],this._current=null,this},t.Scheduler.prototype.remove=function(t){var e=this._queue.remove(t),n=this._repeat.indexOf(t);return-1!=n&&this._repeat.splice(n,1),this._current==t&&(this._current=null),e},t.Scheduler.prototype.next=function(){return this._current=this._queue.get(),this._current},t.Scheduler.Simple=function(){t.Scheduler.call(this)},t.Scheduler.Simple.extend(t.Scheduler),t.Scheduler.Simple.prototype.add=function(e,n){return this._queue.add(e,0),t.Scheduler.prototype.add.call(this,e,n)},t.Scheduler.Simple.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),t.Scheduler.prototype.next.call(this)},t.Scheduler.Speed=function(){t.Scheduler.call(this)},t.Scheduler.Speed.extend(t.Scheduler),t.Scheduler.Speed.prototype.add=function(e,n,i){return this._queue.add(e,void 0!==i?i:1/e.getSpeed()),t.Scheduler.prototype.add.call(this,e,n)},t.Scheduler.Speed.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),t.Scheduler.prototype.next.call(this)},t.Scheduler.Action=function(){t.Scheduler.call(this),this._defaultDuration=1,this._duration=this._defaultDuration},t.Scheduler.Action.extend(t.Scheduler),t.Scheduler.Action.prototype.add=function(e,n,i){return this._queue.add(e,i||this._defaultDuration),t.Scheduler.prototype.add.call(this,e,n)},t.Scheduler.Action.prototype.clear=function(){return this._duration=this._defaultDuration,t.Scheduler.prototype.clear.call(this)},t.Scheduler.Action.prototype.remove=function(e){return e==this._current&&(this._duration=this._defaultDuration),t.Scheduler.prototype.remove.call(this,e)},t.Scheduler.Action.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),t.Scheduler.prototype.next.call(this)},t.Scheduler.Action.prototype.setDuration=function(t){return this._current&&(this._duration=t),this},t.Engine=function(t){this._scheduler=t,this._lock=1},t.Engine.prototype.start=function(){return this.unlock()},t.Engine.prototype.lock=function(){return this._lock++,this},t.Engine.prototype.unlock=function(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var t=this._scheduler.next();if(!t)return this.lock();var e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this},t.Map=function(e,n){this._width=e||t.DEFAULT_WIDTH,this._height=n||t.DEFAULT_HEIGHT},t.Map.prototype.create=function(t){},t.Map.prototype._fillMap=function(t){for(var e=[],n=0;n<this._width;n++){e.push([]);for(var i=0;i<this._height;i++)e[n].push(t)}return e},t.Map.Arena=function(e,n){t.Map.call(this,e,n)},t.Map.Arena.extend(t.Map),t.Map.Arena.prototype.create=function(t){for(var e=this._width-1,n=this._height-1,i=0;i<=e;i++)for(var r=0;r<=n;r++)t(i,r,i&&r&&i<e&&r<n?0:1);return this},t.Map.DividedMaze=function(e,n){t.Map.call(this,e,n),this._stack=[]},t.Map.DividedMaze.extend(t.Map),t.Map.DividedMaze.prototype.create=function(t){var e=this._width,n=this._height;this._map=[];for(var i=0;i<e;i++){this._map.push([]);for(var r=0;r<n;r++){var o=0==i||0==r||i+1==e||r+1==n;this._map[i].push(o?1:0)}}for(this._stack=[[1,1,e-2,n-2]],this._process(),i=0;i<e;i++)for(r=0;r<n;r++)t(i,r,this._map[i][r]);return this._map=null,this},t.Map.DividedMaze.prototype._process=function(){for(;this._stack.length;){var t=this._stack.shift();this._partitionRoom(t)}},t.Map.DividedMaze.prototype._partitionRoom=function(t){for(var e=[],n=[],i=t[0]+1;i<t[2];i++){var r=this._map[i][t[1]-1],o=this._map[i][t[3]+1];!r||!o||i%2||e.push(i)}for(var s=t[1]+1;s<t[3];s++){var a=this._map[t[0]-1][s],c=this._map[t[2]+1][s];!a||!c||s%2||n.push(s)}if(e.length&&n.length){var u=e.random(),h=n.random();this._map[u][h]=1;var l=[],p=[];for(l.push(p),i=t[0];i<u;i++)this._map[i][h]=1,p.push([i,h]);for(p=[],l.push(p),i=u+1;i<=t[2];i++)this._map[i][h]=1,p.push([i,h]);for(p=[],l.push(p),s=t[1];s<h;s++)this._map[u][s]=1,p.push([u,s]);for(p=[],l.push(p),s=h+1;s<=t[3];s++)this._map[u][s]=1,p.push([u,s]);var d=l.random();for(i=0;i<l.length;i++)if((p=l[i])!=d){var f=p.random();this._map[f[0]][f[1]]=0}this._stack.push([t[0],t[1],u-1,h-1]),this._stack.push([u+1,t[1],t[2],h-1]),this._stack.push([t[0],h+1,u-1,t[3]]),this._stack.push([u+1,h+1,t[2],t[3]])}},t.Map.IceyMaze=function(e,n,i){t.Map.call(this,e,n),this._regularity=i||0},t.Map.IceyMaze.extend(t.Map),t.Map.IceyMaze.prototype.create=function(e){var n=this._width,i=this._height,r=this._fillMap(1);n-=n%2?1:2,i-=i%2?1:2;var o=0,s=0,a=0,c=0,u=0,h=!1,l=[[0,0],[0,0],[0,0],[0,0]];do{if(o=1+2*Math.floor(t.RNG.getUniform()*(n-1)/2),s=1+2*Math.floor(t.RNG.getUniform()*(i-1)/2),u||(r[o][s]=0),!r[o][s]){this._randomize(l);do{0==Math.floor(t.RNG.getUniform()*(this._regularity+1))&&this._randomize(l),h=!0;for(var p=0;p<4;p++)if(a=o+2*l[p][0],c=s+2*l[p][1],this._isFree(r,a,c,n,i)){r[a][c]=0,r[o+l[p][0]][s+l[p][1]]=0,o=a,s=c,h=!1,u++;break}}while(!h)}}while(u+1<n*i/4);for(p=0;p<this._width;p++)for(var d=0;d<this._height;d++)e(p,d,r[p][d]);return this._map=null,this},t.Map.IceyMaze.prototype._randomize=function(e){for(var n=0;n<4;n++)e[n][0]=0,e[n][1]=0;switch(Math.floor(4*t.RNG.getUniform())){case 0:e[0][0]=-1,e[1][0]=1,e[2][1]=-1,e[3][1]=1;break;case 1:e[3][0]=-1,e[2][0]=1,e[1][1]=-1,e[0][1]=1;break;case 2:e[2][0]=-1,e[3][0]=1,e[0][1]=-1,e[1][1]=1;break;case 3:e[1][0]=-1,e[0][0]=1,e[3][1]=-1,e[2][1]=1}},t.Map.IceyMaze.prototype._isFree=function(t,e,n,i,r){return!(e<1||n<1||e>=i||n>=r)&&t[e][n]},t.Map.EllerMaze=function(e,n){t.Map.call(this,e,n)},t.Map.EllerMaze.extend(t.Map),t.Map.EllerMaze.prototype.create=function(e){for(var n=this._fillMap(1),i=Math.ceil((this._width-2)/2),r=[],o=[],s=0;s<i;s++)r.push(s),o.push(s);r.push(i-1);for(var a=1;a+3<this._height;a+=2)for(s=0;s<i;s++){var c=a;n[u=2*s+1][c]=0,s!=r[s+1]&&t.RNG.getUniform()>.375&&(this._addToList(s,r,o),n[u+1][c]=0),s!=r[s]&&t.RNG.getUniform()>.375?this._removeFromList(s,r,o):n[u][c+1]=0}for(s=0;s<i;s++){var u;c=a,n[u=2*s+1][c]=0,s!=r[s+1]&&(s==r[s]||t.RNG.getUniform()>.375)&&(this._addToList(s,r,o),n[u+1][c]=0),this._removeFromList(s,r,o)}for(s=0;s<this._width;s++)for(a=0;a<this._height;a++)e(s,a,n[s][a]);return this},t.Map.EllerMaze.prototype._removeFromList=function(t,e,n){n[e[t]]=n[t],e[n[t]]=e[t],n[t]=t,e[t]=t},t.Map.EllerMaze.prototype._addToList=function(t,e,n){n[e[t+1]]=n[t],e[n[t]]=e[t+1],n[t]=t+1,e[t+1]=t},t.Map.Cellular=function(e,n,i){t.Map.call(this,e,n),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=t.DIRS[this._options.topology],this._map=this._fillMap(0)},t.Map.Cellular.extend(t.Map),t.Map.Cellular.prototype.randomize=function(e){for(var n=0;n<this._width;n++)for(var i=0;i<this._height;i++)this._map[n][i]=t.RNG.getUniform()<e?1:0;return this},t.Map.Cellular.prototype.setOptions=function(t){for(var e in t)this._options[e]=t[e]},t.Map.Cellular.prototype.set=function(t,e,n){this._map[t][e]=n},t.Map.Cellular.prototype.create=function(t){for(var e=this._fillMap(0),n=this._options.born,i=this._options.survive,r=0;r<this._height;r++){var o=1,s=0;6==this._options.topology&&(o=2,s=r%2);for(var a=s;a<this._width;a+=o){var c=this._map[a][r],u=this._getNeighbors(a,r);c&&-1!=i.indexOf(u)?e[a][r]=1:c||-1==n.indexOf(u)||(e[a][r]=1)}}this._map=e,t&&this._serviceCallback(t)},t.Map.Cellular.prototype._serviceCallback=function(t){for(var e=0;e<this._height;e++){var n=1,i=0;6==this._options.topology&&(n=2,i=e%2);for(var r=i;r<this._width;r+=n)t(r,e,this._map[r][e])}},t.Map.Cellular.prototype._getNeighbors=function(t,e){for(var n=0,i=0;i<this._dirs.length;i++){var r=this._dirs[i],o=t+r[0],s=e+r[1];o<0||o>=this._width||s<0||s>=this._height||(n+=1==this._map[o][s]?1:0)}return n},t.Map.Cellular.prototype.connect=function(e,n,i){n||(n=0);var r=[],o={},s=1,a=[0,0];6==this._options.topology&&(s=2,a=[0,1]);for(var c=0;c<this._height;c++)for(var u=a[c%2];u<this._width;u+=s)if(this._freeSpace(u,c,n)){var h=[u,c];o[this._pointKey(h)]=h,r.push([u,c])}var l=r[t.RNG.getUniformInt(0,r.length-1)],p=this._pointKey(l),d={};for(d[p]=l,delete o[p],this._findConnected(d,o,[l],!1,n);Object.keys(o).length>0;){var f=(h=this._getFromTo(d,o))[0],_=h[1],g={};g[this._pointKey(f)]=f,this._findConnected(g,o,[f],!0,n);var y=6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected;for(var m in y.call(this,_,f,d,o,n,i),g){var v=g[m];this._map[v[0]][v[1]]=n,d[m]=v,delete o[m]}}e&&this._serviceCallback(e)},t.Map.Cellular.prototype._getFromTo=function(e,n){for(var i,r,o=Object.keys(e),s=Object.keys(n),a=0;a<5;a++){var c;if(o.length<s.length?(r=e[(c=o)[t.RNG.getUniformInt(0,c.length-1)]],i=this._getClosest(r,n)):(i=n[(c=s)[t.RNG.getUniformInt(0,c.length-1)]],r=this._getClosest(i,e)),(i[0]-r[0])*(i[0]-r[0])+(i[1]-r[1])*(i[1]-r[1])<64)break}return[i,r]},t.Map.Cellular.prototype._getClosest=function(t,e){var n=null,i=null;for(k in e){var r=e[k],o=(r[0]-t[0])*(r[0]-t[0])+(r[1]-t[1])*(r[1]-t[1]);(null==i||o<i)&&(i=o,n=r)}return n},t.Map.Cellular.prototype._findConnected=function(t,e,n,i,r){for(;n.length>0;){var o,s=n.splice(0,1)[0];o=6==this._options.topology?[[s[0]+2,s[1]],[s[0]+1,s[1]-1],[s[0]-1,s[1]-1],[s[0]-2,s[1]],[s[0]-1,s[1]+1],[s[0]+1,s[1]+1]]:[[s[0]+1,s[1]],[s[0]-1,s[1]],[s[0],s[1]+1],[s[0],s[1]-1]];for(var a=0;a<o.length;a++){var c=this._pointKey(o[a]);null==t[c]&&this._freeSpace(o[a][0],o[a][1],r)&&(t[c]=o[a],i||delete e[c],n.push(o[a]))}}},t.Map.Cellular.prototype._tunnelToConnected=function(t,e,n,i,r,o){var s,a;this._pointKey(e),e[0]<t[0]?(s=e,a=t):(s=t,a=e);for(var c=s[0];c<=a[0];c++){this._map[c][s[1]]=r;var u=[c,s[1]];n[p=this._pointKey(u)]=u,delete i[p]}o&&s[0]<a[0]&&o(s,[a[0],s[1]]);var h=a[0];e[1]<t[1]?(s=e,a=t):(s=t,a=e);for(var l=s[1];l<a[1];l++){var p;this._map[h][l]=r,u=[h,l],n[p=this._pointKey(u)]=u,delete i[p]}o&&s[1]<a[1]&&o([a[0],s[1]],[a[0],a[1]])},t.Map.Cellular.prototype._tunnelToConnected6=function(t,e,n,i,r,o){var s,a;e[0]<t[0]?(s=e,a=t):(s=t,a=e);for(var c=s[0],u=s[1];c!=a[0]||u!=a[1];){var h=2;u<a[1]?(u++,h=1):u>a[1]&&(u--,h=1),c<a[0]?c+=h:c>a[0]?c-=h:a[1]%2?c-=h:c+=h,this._map[c][u]=r;var l=[c,u],p=this._pointKey(l);n[p]=l,delete i[p]}o&&o(e,t)},t.Map.Cellular.prototype._freeSpace=function(t,e,n){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==n},t.Map.Cellular.prototype._pointKey=function(t){return t[0]+"."+t[1]},t.Map.Dungeon=function(e,n){t.Map.call(this,e,n),this._rooms=[],this._corridors=[]},t.Map.Dungeon.extend(t.Map),t.Map.Dungeon.prototype.getRooms=function(){return this._rooms},t.Map.Dungeon.prototype.getCorridors=function(){return this._corridors},t.Map.Digger=function(e,n,i){for(var r in t.Map.Dungeon.call(this,e,n),this._options={roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i)this._options[r]=i[r];this._features={Room:4,Corridor:4},this._featureAttempts=20,this._walls={},this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)},t.Map.Digger.extend(t.Map.Dungeon),t.Map.Digger.prototype.create=function(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;var e=(this._width-2)*(this._height-2);this._firstRoom();var n=Date.now();do{if(Date.now()-n>this._options.timeLimit)break;var i=this._findWall();if(!i)break;var r=i.split(","),o=parseInt(r[0]),s=parseInt(r[1]),a=this._getDiggingDirection(o,s);if(a){var c=0;do{if(c++,this._tryFeature(o,s,a[0],a[1])){this._removeSurroundingWalls(o,s),this._removeSurroundingWalls(o-a[0],s-a[1]);break}}while(c<this._featureAttempts);var u=0;for(var h in this._walls)this._walls[h]>1&&u++}}while(this._dug/e<this._options.dugPercentage||u);if(this._addDoors(),t)for(var l=0;l<this._width;l++)for(var p=0;p<this._height;p++)t(l,p,this._map[l][p]);return this._walls={},this._map=null,this},t.Map.Digger.prototype._digCallback=function(t,e,n){0==n||2==n?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1},t.Map.Digger.prototype._isWallCallback=function(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]},t.Map.Digger.prototype._canBeDugCallback=function(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]},t.Map.Digger.prototype._priorityWallCallback=function(t,e){this._walls[t+","+e]=2},t.Map.Digger.prototype._firstRoom=function(){var e=Math.floor(this._width/2),n=Math.floor(this._height/2),i=t.Map.Feature.Room.createRandomCenter(e,n,this._options);this._rooms.push(i),i.create(this._digCallback)},t.Map.Digger.prototype._findWall=function(){var t=[],e=[];for(var n in this._walls)2==this._walls[n]?e.push(n):t.push(n);var i=e.length?e:t;return i.length?(n=i.sort().random(),delete this._walls[n],n):null},t.Map.Digger.prototype._tryFeature=function(e,n,i,r){var o=t.RNG.getWeightedValue(this._features);return!!(o=t.Map.Feature[o].createRandomAt(e,n,i,r,this._options)).isValid(this._isWallCallback,this._canBeDugCallback)&&(o.create(this._digCallback),o instanceof t.Map.Feature.Room&&this._rooms.push(o),o instanceof t.Map.Feature.Corridor&&(o.createPriorityWalls(this._priorityWallCallback),this._corridors.push(o)),!0)},t.Map.Digger.prototype._removeSurroundingWalls=function(e,n){for(var i=t.DIRS[4],r=0;r<i.length;r++){var o=i[r],s=e+o[0],a=n+o[1];delete this._walls[s+","+a],s=e+2*o[0],a=n+2*o[1],delete this._walls[s+","+a]}},t.Map.Digger.prototype._getDiggingDirection=function(e,n){if(e<=0||n<=0||e>=this._width-1||n>=this._height-1)return null;for(var i=null,r=t.DIRS[4],o=0;o<r.length;o++){var s=r[o],a=e+s[0],c=n+s[1];if(!this._map[a][c]){if(i)return null;i=s}}return i?[-i[0],-i[1]]:null},t.Map.Digger.prototype._addDoors=function(){for(var t=this._map,e=function(e,n){return 1==t[e][n]},n=0;n<this._rooms.length;n++){var i=this._rooms[n];i.clearDoors(),i.addDoors(e)}},t.Map.Uniform=function(e,n,i){for(var r in t.Map.Dungeon.call(this,e,n),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},i)this._options[r]=i[r];this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)},t.Map.Uniform.extend(t.Map.Dungeon),t.Map.Uniform.prototype.create=function(t){for(var e=Date.now();;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(var n=0;n<this._width;n++)for(var i=0;i<this._height;i++)t(n,i,this._map[n][i]);return this},t.Map.Uniform.prototype._generateRooms=function(){var t=this._width-2,e=this._height-2;do{var n=this._generateRoom();if(this._dug/(t*e)>this._options.roomDugPercentage)break}while(n)},t.Map.Uniform.prototype._generateRoom=function(){for(var e=0;e<this._roomAttempts;){e++;var n=t.Map.Feature.Room.createRandom(this._width,this._height,this._options);if(n.isValid(this._isWallCallback,this._canBeDugCallback))return n.create(this._digCallback),this._rooms.push(n),n}return null},t.Map.Uniform.prototype._generateCorridors=function(){for(var t=0;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(var e=0;e<this._rooms.length;e++){var n=this._rooms[e];n.clearDoors(),n.create(this._digCallback)}for(this._unconnected=this._rooms.slice().randomize(),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){var i=this._connected.random(),r=this._closestRoom(this._unconnected,i),o=this._closestRoom(this._connected,r);if(!this._connectRooms(r,o))break;if(!this._unconnected.length)return!0}}return!1},t.Map.Uniform.prototype._closestRoom=function(t,e){for(var n=1/0,i=e.getCenter(),r=null,o=0;o<t.length;o++){var s=t[o],a=s.getCenter(),c=a[0]-i[0],u=a[1]-i[1],h=c*c+u*u;h<n&&(n=h,r=s)}return r},t.Map.Uniform.prototype._connectRooms=function(t,e){var n,i=t.getCenter(),r=e.getCenter(),o=r[0]-i[0],s=r[1]-i[1];if(Math.abs(o)<Math.abs(s))var a=(2+(n=s>0?2:0))%4,c=e.getLeft(),u=e.getRight(),h=0;else a=(2+(n=o>0?1:3))%4,c=e.getTop(),u=e.getBottom(),h=1;var l=this._placeInWall(t,n);if(!l)return!1;if(l[h]>=c&&l[h]<=u){var p=l.slice(),d=null;switch(a){case 0:d=e.getTop()-1;break;case 1:d=e.getRight()+1;break;case 2:d=e.getBottom()+1;break;case 3:d=e.getLeft()-1}p[(h+1)%2]=d,this._digLine([l,p])}else if(l[h]<c-1||l[h]>u+1){var f=l[h]-r[h];switch(a){case 0:case 1:var _=f<0?3:1;break;case 2:case 3:_=f<0?1:3}if(a=(a+_)%4,!(p=this._placeInWall(e,a)))return!1;(y=[0,0])[h]=l[h],y[g=(h+1)%2]=p[g],this._digLine([l,y,p])}else{var g=(h+1)%2;if(!(p=this._placeInWall(e,a)))return!1;var y=Math.round((p[g]+l[g])/2),m=[0,0],v=[0,0];m[h]=l[h],m[g]=y,v[h]=p[h],v[g]=y,this._digLine([l,m,v,p])}return t.addDoor(l[0],l[1]),e.addDoor(p[0],p[1]),-1!=(h=this._unconnected.indexOf(t))&&(this._unconnected.splice(h,1),this._connected.push(t)),-1!=(h=this._unconnected.indexOf(e))&&(this._unconnected.splice(h,1),this._connected.push(e)),!0},t.Map.Uniform.prototype._placeInWall=function(t,e){var n=[0,0],i=[0,0],r=0;switch(e){case 0:i=[1,0],n=[t.getLeft(),t.getTop()-1],r=t.getRight()-t.getLeft()+1;break;case 1:i=[0,1],n=[t.getRight()+1,t.getTop()],r=t.getBottom()-t.getTop()+1;break;case 2:i=[1,0],n=[t.getLeft(),t.getBottom()+1],r=t.getRight()-t.getLeft()+1;break;case 3:i=[0,1],n=[t.getLeft()-1,t.getTop()],r=t.getBottom()-t.getTop()+1}for(var o=[],s=-2,a=0;a<r;a++){var c=n[0]+a*i[0],u=n[1]+a*i[1];o.push(null),1==this._map[c][u]?s!=a-1&&(o[a]=[c,u]):(s=a,a&&(o[a-1]=null))}for(a=o.length-1;a>=0;a--)o[a]||o.splice(a,1);return o.length?o.random():null},t.Map.Uniform.prototype._digLine=function(e){for(var n=1;n<e.length;n++){var i=e[n-1],r=e[n],o=new t.Map.Feature.Corridor(i[0],i[1],r[0],r[1]);o.create(this._digCallback),this._corridors.push(o)}},t.Map.Uniform.prototype._digCallback=function(t,e,n){this._map[t][e]=n,0==n&&this._dug++},t.Map.Uniform.prototype._isWallCallback=function(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]},t.Map.Uniform.prototype._canBeDugCallback=function(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]},t.Map.Rogue=function(e,n,i){for(var r in t.Map.call(this,e,n),this._options={cellWidth:3,cellHeight:3},i)this._options[r]=i[r];this._options.hasOwnProperty("roomWidth")||(this._options.roomWidth=this._calculateRoomSize(this._width,this._options.cellWidth)),this._options.hasOwnProperty("roomHeight")||(this._options.roomHeight=this._calculateRoomSize(this._height,this._options.cellHeight))},t.Map.Rogue.extend(t.Map),t.Map.Rogue.prototype.create=function(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(var e=0;e<this._width;e++)for(var n=0;n<this._height;n++)t(e,n,this.map[e][n]);return this},t.Map.Rogue.prototype._calculateRoomSize=function(t,e){var n=Math.floor(t/e*.8),i=Math.floor(t/e*.25);return i<2&&(i=2),n<2&&(n=2),[i,n]},t.Map.Rogue.prototype._initRooms=function(){for(var t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(var e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}},t.Map.Rogue.prototype._connectRooms=function(){var e,n,i,r,o,s=t.RNG.getUniformInt(0,this._options.cellWidth-1),a=t.RNG.getUniformInt(0,this._options.cellHeight-1),c=!1;do{var u=[0,2,4,6];u=u.randomize();do{if(c=!1,e=u.pop(),n=s+t.DIRS[8][e][0],i=a+t.DIRS[8][e][1],!(n<0||n>=this._options.cellWidth||i<0||i>=this._options.cellHeight)){if((r=this.rooms[s][a]).connections.length>0&&r.connections[0][0]==n&&r.connections[0][1]==i)break;0==(o=this.rooms[n][i]).connections.length&&(o.connections.push([s,a]),this.connectedCells.push([n,i]),s=n,a=i,c=!0)}}while(u.length>0&&0==c)}while(u.length>0)},t.Map.Rogue.prototype._connectUnconnectedRooms=function(){var e,n,i,r=this._options.cellWidth,o=this._options.cellHeight;this.connectedCells=this.connectedCells.randomize();for(var s=0;s<this._options.cellWidth;s++)for(var a=0;a<this._options.cellHeight;a++)if(0==(e=this.rooms[s][a]).connections.length){var c=[0,2,4,6];c=c.randomize(),i=!1;do{var u=c.pop(),h=s+t.DIRS[8][u][0],l=a+t.DIRS[8][u][1];if(!(h<0||h>=r||l<0||l>=o)){if(i=!0,0==(n=this.rooms[h][l]).connections.length)break;for(var p=0;p<n.connections.length;p++)if(n.connections[p][0]==s&&n.connections[p][1]==a){i=!1;break}if(i)break}}while(c.length);i?e.connections.push([n.cellx,n.celly]):console.log("-- Unable to connect room.")}},t.Map.Rogue.prototype._createRandomRoomConnections=function(t){},t.Map.Rogue.prototype._createRooms=function(){for(var e,n,i,r,o,s=this._width,a=this._height,c=this._options.cellWidth,u=this._options.cellHeight,h=Math.floor(this._width/c),l=Math.floor(this._height/u),p=this._options.roomWidth,d=this._options.roomHeight,f=0;f<c;f++)for(var _=0;_<u;_++){if(r=l*_,0==(i=h*f)&&(i=1),0==r&&(r=1),e=t.RNG.getUniformInt(p[0],p[1]),n=t.RNG.getUniformInt(d[0],d[1]),_>0)for(o=this.rooms[f][_-1];r-(o.y+o.height)<3;)r++;if(f>0)for(o=this.rooms[f-1][_];i-(o.x+o.width)<3;)i++;for(var g=Math.round(t.RNG.getUniformInt(0,h-e)/2),y=Math.round(t.RNG.getUniformInt(0,l-n)/2);i+g+e>=s;)g?g--:e--;for(;r+y+n>=a;)y?y--:n--;i+=g,r+=y,this.rooms[f][_].x=i,this.rooms[f][_].y=r,this.rooms[f][_].width=e,this.rooms[f][_].height=n;for(var m=i;m<i+e;m++)for(var v=r;v<r+n;v++)this.map[m][v]=0}},t.Map.Rogue.prototype._getWallPosition=function(e,n){var i,r,o;return 1==n||3==n?(i=t.RNG.getUniformInt(e.x+1,e.x+e.width-2),o=1==n?1+(r=e.y-2):(r=e.y+e.height+1)-1,this.map[i][o]=0):2!=n&&4!=n||(r=t.RNG.getUniformInt(e.y+1,e.y+e.height-2),o=2==n?(i=e.x+e.width+1)-1:1+(i=e.x-2),this.map[o][r]=0),[i,r]},t.Map.Rogue.prototype._drawCorridor=function(e,n){var i,r,o,s,a=n[0]-e[0],c=n[1]-e[1],u=e[0],h=e[1],l=[],p=Math.abs(a),d=Math.abs(c),f=t.RNG.getUniform(),_=f,g=1-f;for(r=a>0?2:6,o=c>0?4:0,p<d?(i=Math.ceil(d*_),l.push([o,i]),l.push([r,p]),i=Math.floor(d*g),l.push([o,i])):(i=Math.ceil(p*_),l.push([r,i]),l.push([o,d]),i=Math.floor(p*g),l.push([r,i])),this.map[u][h]=0;l.length>0;)for(s=l.pop();s[1]>0;)u+=t.DIRS[8][s[0]][0],h+=t.DIRS[8][s[0]][1],this.map[u][h]=0,s[1]=s[1]-1},t.Map.Rogue.prototype._createCorridors=function(){for(var t,e,n,i,r,o=this._options.cellWidth,s=this._options.cellHeight,a=0;a<o;a++)for(var c=0;c<s;c++){t=this.rooms[a][c];for(var u=0;u<t.connections.length;u++)e=t.connections[u],(n=this.rooms[e[0]][e[1]]).cellx>t.cellx?(i=2,r=4):n.cellx<t.cellx?(i=4,r=2):n.celly>t.celly?(i=3,r=1):n.celly<t.celly&&(i=1,r=3),this._drawCorridor(this._getWallPosition(t,i),this._getWallPosition(n,r))}},t.Map.Feature=function(){},t.Map.Feature.prototype.isValid=function(t){},t.Map.Feature.prototype.create=function(t){},t.Map.Feature.prototype.debug=function(){},t.Map.Feature.createRandomAt=function(t,e,n,i,r){},t.Map.Feature.Room=function(t,e,n,i,r,o){this._x1=t,this._y1=e,this._x2=n,this._y2=i,this._doors={},arguments.length>4&&this.addDoor(r,o)},t.Map.Feature.Room.extend(t.Map.Feature),t.Map.Feature.Room.createRandomAt=function(e,n,i,r,o){var s,a,c=o.roomWidth[0],u=o.roomWidth[1],h=t.RNG.getUniformInt(c,u),l=(c=o.roomHeight[0],u=o.roomHeight[1],t.RNG.getUniformInt(c,u));if(1==i)return new this(e+1,s=n-Math.floor(t.RNG.getUniform()*l),e+h,s+l-1,e,n);if(-1==i)return new this(e-h,s=n-Math.floor(t.RNG.getUniform()*l),e-1,s+l-1,e,n);if(1==r)return new this(a=e-Math.floor(t.RNG.getUniform()*h),n+1,a+h-1,n+l,e,n);if(-1==r)return new this(a=e-Math.floor(t.RNG.getUniform()*h),n-l,a+h-1,n-1,e,n);throw new Error("dx or dy must be 1 or -1")},t.Map.Feature.Room.createRandomCenter=function(e,n,i){var r=i.roomWidth[0],o=i.roomWidth[1],s=t.RNG.getUniformInt(r,o),a=(r=i.roomHeight[0],o=i.roomHeight[1],t.RNG.getUniformInt(r,o)),c=e-Math.floor(t.RNG.getUniform()*s),u=n-Math.floor(t.RNG.getUniform()*a);return new this(c,u,c+s-1,u+a-1)},t.Map.Feature.Room.createRandom=function(e,n,i){var r=i.roomWidth[0],o=i.roomWidth[1],s=t.RNG.getUniformInt(r,o),a=(r=i.roomHeight[0],o=i.roomHeight[1],t.RNG.getUniformInt(r,o)),c=e-s-1,u=n-a-1,h=1+Math.floor(t.RNG.getUniform()*c),l=1+Math.floor(t.RNG.getUniform()*u);return new this(h,l,h+s-1,l+a-1)},t.Map.Feature.Room.prototype.addDoor=function(t,e){return this._doors[t+","+e]=1,this},t.Map.Feature.Room.prototype.getDoors=function(t){for(var e in this._doors){var n=e.split(",");t(parseInt(n[0]),parseInt(n[1]))}return this},t.Map.Feature.Room.prototype.clearDoors=function(){return this._doors={},this},t.Map.Feature.Room.prototype.addDoors=function(t){for(var e=this._x1-1,n=this._x2+1,i=this._y1-1,r=this._y2+1,o=e;o<=n;o++)for(var s=i;s<=r;s++)o!=e&&o!=n&&s!=i&&s!=r||t(o,s)||this.addDoor(o,s);return this},t.Map.Feature.Room.prototype.debug=function(){console.log("room",this._x1,this._y1,this._x2,this._y2)},t.Map.Feature.Room.prototype.isValid=function(t,e){for(var n=this._x1-1,i=this._x2+1,r=this._y1-1,o=this._y2+1,s=n;s<=i;s++)for(var a=r;a<=o;a++)if(s==n||s==i||a==r||a==o){if(!t(s,a))return!1}else if(!e(s,a))return!1;return!0},t.Map.Feature.Room.prototype.create=function(t){for(var e=this._x1-1,n=this._x2+1,i=this._y1-1,r=this._y2+1,o=e;o<=n;o++)for(var s=i;s<=r;s++)t(o,s,o+","+s in this._doors?2:o==e||o==n||s==i||s==r?1:0)},t.Map.Feature.Room.prototype.getCenter=function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]},t.Map.Feature.Room.prototype.getLeft=function(){return this._x1},t.Map.Feature.Room.prototype.getRight=function(){return this._x2},t.Map.Feature.Room.prototype.getTop=function(){return this._y1},t.Map.Feature.Room.prototype.getBottom=function(){return this._y2},t.Map.Feature.Corridor=function(t,e,n,i){this._startX=t,this._startY=e,this._endX=n,this._endY=i,this._endsWithAWall=!0},t.Map.Feature.Corridor.extend(t.Map.Feature),t.Map.Feature.Corridor.createRandomAt=function(e,n,i,r,o){var s=o.corridorLength[0],a=o.corridorLength[1],c=t.RNG.getUniformInt(s,a);return new this(e,n,e+i*c,n+r*c)},t.Map.Feature.Corridor.prototype.debug=function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)},t.Map.Feature.Corridor.prototype.isValid=function(t,e){var n=this._startX,i=this._startY,r=this._endX-n,o=this._endY-i,s=1+Math.max(Math.abs(r),Math.abs(o));r&&(r/=Math.abs(r)),o&&(o/=Math.abs(o));for(var a=o,c=-r,u=!0,h=0;h<s;h++){var l=n+h*r,p=i+h*o;if(e(l,p)||(u=!1),t(l+a,p+c)||(u=!1),t(l-a,p-c)||(u=!1),!u){s=h,this._endX=l-r,this._endY=p-o;break}}if(0==s)return!1;if(1==s&&t(this._endX+r,this._endY+o))return!1;var d=!t(this._endX+r+a,this._endY+o+c),f=!t(this._endX+r-a,this._endY+o-c);return this._endsWithAWall=t(this._endX+r,this._endY+o),!d&&!f||!this._endsWithAWall},t.Map.Feature.Corridor.prototype.create=function(t){var e=this._startX,n=this._startY,i=this._endX-e,r=this._endY-n,o=1+Math.max(Math.abs(i),Math.abs(r));i&&(i/=Math.abs(i)),r&&(r/=Math.abs(r));for(var s=0;s<o;s++)t(e+s*i,n+s*r,0);return!0},t.Map.Feature.Corridor.prototype.createPriorityWalls=function(t){if(this._endsWithAWall){var e=this._startX,n=this._startY,i=this._endX-e,r=this._endY-n;i&&(i/=Math.abs(i)),r&&(r/=Math.abs(r));var o=r,s=-i;t(this._endX+i,this._endY+r),t(this._endX+o,this._endY+s),t(this._endX-o,this._endY-s)}},t.Noise=function(){},t.Noise.prototype.get=function(t,e){},t.Noise.Simplex=function(e){t.Noise.call(this),this._F2=.5*(Math.sqrt(3)-1),this._G2=(3-Math.sqrt(3))/6,this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];for(var n=[],i=e||256,r=0;r<i;r++)n.push(r);for(n=n.randomize(),this._perms=[],this._indexes=[],r=0;r<2*i;r++)this._perms.push(n[r%i]),this._indexes.push(this._perms[r]%this._gradients.length)},t.Noise.Simplex.extend(t.Noise),t.Noise.Simplex.prototype.get=function(t,e){var n,i,r,o=this._perms,s=this._indexes,a=o.length/2,c=this._G2,u=0,h=0,l=0,p=(t+e)*this._F2,d=Math.floor(t+p),f=Math.floor(e+p),_=(d+f)*c,g=t-(d-_),y=e-(f-_);g>y?(i=1,r=0):(i=0,r=1);var m=g-i+c,v=y-r+c,T=g-1+2*c,S=y-1+2*c,w=d.mod(a),E=f.mod(a),M=.5-g*g-y*y;M>=0&&(M*=M,n=s[w+o[E]],u=M*M*((A=this._gradients[n])[0]*g+A[1]*y));var b=.5-m*m-v*v;b>=0&&(b*=b,n=s[w+i+o[E+r]],h=b*b*((A=this._gradients[n])[0]*m+A[1]*v));var A,C=.5-T*T-S*S;return C>=0&&(C*=C,n=s[w+1+o[E+1]],l=C*C*((A=this._gradients[n])[0]*T+A[1]*S)),70*(u+h+l)},t.FOV=function(t,e){for(var n in this._lightPasses=t,this._options={topology:8},e)this._options[n]=e[n]},t.FOV.prototype.compute=function(t,e,n,i){},t.FOV.prototype._getCircle=function(e,n,i){var r,o,s,a=[];switch(this._options.topology){case 4:o=1,s=[0,1],r=[t.DIRS[8][7],t.DIRS[8][1],t.DIRS[8][3],t.DIRS[8][5]];break;case 6:r=t.DIRS[6],o=1,s=[-1,1];break;case 8:r=t.DIRS[4],o=2,s=[-1,1]}for(var c=e+s[0]*i,u=n+s[1]*i,h=0;h<r.length;h++)for(var l=0;l<i*o;l++)a.push([c,u]),c+=r[h][0],u+=r[h][1];return a},t.FOV.DiscreteShadowcasting=function(e,n){t.FOV.call(this,e,n)},t.FOV.DiscreteShadowcasting.extend(t.FOV),t.FOV.DiscreteShadowcasting.prototype.compute=function(t,e,n,i){if(this._coords,this._map,i(t,e,0,1),this._lightPasses(t,e))for(var r,o,s,a,c,u=[],h=1;h<=n;h++)for(var l=this._getCircle(t,e,h),p=360/l.length,d=0;d<l.length;d++)if(s=l[d][0],a=l[d][1],o=(r=p*(d-.5))+p,c=!this._lightPasses(s,a),this._visibleCoords(Math.floor(r),Math.ceil(o),c,u)&&i(s,a,h,1),2==u.length&&0==u[0]&&360==u[1])return},t.FOV.DiscreteShadowcasting.prototype._visibleCoords=function(t,e,n,i){if(t<0){var r=this._visibleCoords(0,e,n,i),o=this._visibleCoords(360+t,360,n,i);return r||o}for(var s=0;s<i.length&&i[s]<t;)s++;if(s==i.length)return n&&i.push(t,e),!0;var a=0;if(s%2){for(;s<i.length&&i[s]<e;)s++,a++;return 0!=a&&(n&&(a%2?i.splice(s-a,a,e):i.splice(s-a,a)),!0)}for(;s<i.length&&i[s]<e;)s++,a++;return(t!=i[s-a]||1!=a)&&(n&&(a%2?i.splice(s-a,a,t):i.splice(s-a,a,t,e)),!0)},t.FOV.PreciseShadowcasting=function(e,n){t.FOV.call(this,e,n)},t.FOV.PreciseShadowcasting.extend(t.FOV),t.FOV.PreciseShadowcasting.prototype.compute=function(t,e,n,i){if(i(t,e,0,1),this._lightPasses(t,e))for(var r,o,s,a,c,u,h=[],l=1;l<=n;l++)for(var p=this._getCircle(t,e,l),d=p.length,f=0;f<d;f++)if(r=p[f][0],o=p[f][1],a=[f?2*f-1:2*d-1,2*d],c=[2*f+1,2*d],s=!this._lightPasses(r,o),(u=this._checkVisibility(a,c,s,h))&&i(r,o,l,u),2==h.length&&0==h[0][0]&&h[1][0]==h[1][1])return},t.FOV.PreciseShadowcasting.prototype._checkVisibility=function(t,e,n,i){if(t[0]>e[0])return(this._checkVisibility(t,[t[1],t[1]],n,i)+this._checkVisibility([0,1],e,n,i))/2;for(var r=0,o=!1;r<i.length;){if((c=(u=i[r])[0]*t[1]-t[0]*u[1])>=0){0!=c||r%2||(o=!0);break}r++}for(var s=i.length,a=!1;s--;){var c,u=i[s];if((c=e[0]*u[1]-u[0]*e[1])>=0){0==c&&s%2&&(a=!0);break}}var h,l=!0;if(r==s&&(o||a)?l=!1:o&&a&&r+1==s&&s%2?l=!1:r>s&&r%2&&(l=!1),!l)return 0;var p=s-r+1;if(p%2)if(r%2){var d=i[r];h=(e[0]*d[1]-d[0]*e[1])/(d[1]*e[1]),n&&i.splice(r,p,e)}else h=((d=i[s])[0]*t[1]-t[0]*d[1])/(t[1]*d[1]),n&&i.splice(r,p,t);else{if(!(r%2))return n&&i.splice(r,p,t,e),1;var f=i[r],_=i[s];h=(_[0]*f[1]-f[0]*_[1])/(f[1]*_[1]),n&&i.splice(r,p)}return h/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))},t.FOV.RecursiveShadowcasting=function(e,n){t.FOV.call(this,e,n)},t.FOV.RecursiveShadowcasting.extend(t.FOV),t.FOV.RecursiveShadowcasting.OCTANTS=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]],t.FOV.RecursiveShadowcasting.prototype.compute=function(e,n,i,r){r(e,n,0,1);for(var o=0;o<t.FOV.RecursiveShadowcasting.OCTANTS.length;o++)this._renderOctant(e,n,t.FOV.RecursiveShadowcasting.OCTANTS[o],i,r)},t.FOV.RecursiveShadowcasting.prototype.compute180=function(e,n,i,r,o){o(e,n,0,1);var s=(r-1+8)%8,a=(r-2+8)%8,c=(r+1+8)%8;this._renderOctant(e,n,t.FOV.RecursiveShadowcasting.OCTANTS[a],i,o),this._renderOctant(e,n,t.FOV.RecursiveShadowcasting.OCTANTS[s],i,o),this._renderOctant(e,n,t.FOV.RecursiveShadowcasting.OCTANTS[r],i,o),this._renderOctant(e,n,t.FOV.RecursiveShadowcasting.OCTANTS[c],i,o)},t.FOV.RecursiveShadowcasting.prototype.compute90=function(e,n,i,r,o){o(e,n,0,1);var s=(r-1+8)%8;this._renderOctant(e,n,t.FOV.RecursiveShadowcasting.OCTANTS[r],i,o),this._renderOctant(e,n,t.FOV.RecursiveShadowcasting.OCTANTS[s],i,o)},t.FOV.RecursiveShadowcasting.prototype._renderOctant=function(t,e,n,i,r){this._castVisibility(t,e,1,1,0,i+1,n[0],n[1],n[2],n[3],r)},t.FOV.RecursiveShadowcasting.prototype._castVisibility=function(t,e,n,i,r,o,s,a,c,u,h){if(!(i<r))for(var l=n;l<=o;l++){for(var p=-l-1,d=-l,f=!1,_=0;p<=0;){var g=t+(p+=1)*s+d*a,y=e+p*c+d*u,m=(p-.5)/(d+.5),v=(p+.5)/(d-.5);if(!(v>i)){if(m<r)break;if(p*p+d*d<o*o&&h(g,y,l,1),f){if(!this._lightPasses(g,y)){_=v;continue}f=!1,i=_}else!this._lightPasses(g,y)&&l<o&&(f=!0,this._castVisibility(t,e,l+1,i,m,o,s,a,c,u,h),_=v)}}if(f)break}},t.Color={fromString:function(t){var e,n;if(t in this._cache)e=this._cache[t];else{if("#"==t.charAt(0)){var i=t.match(/[0-9a-f]/gi).map(function(t){return parseInt(t,16)});if(3==i.length)e=i.map(function(t){return 17*t});else{for(var r=0;r<3;r++)i[r+1]+=16*i[r],i.splice(r,1);e=i}}else e=(n=t.match(/rgb\(([0-9, ]+)\)/i))?n[1].split(/\s*,\s*/).map(function(t){return parseInt(t)}):[0,0,0];this._cache[t]=e}return e.slice()},add:function(t,e){for(var n=t.slice(),i=0;i<3;i++)for(var r=1;r<arguments.length;r++)n[i]+=arguments[r][i];return n},add_:function(t,e){for(var n=0;n<3;n++)for(var i=1;i<arguments.length;i++)t[n]+=arguments[i][n];return t},multiply:function(t,e){for(var n=t.slice(),i=0;i<3;i++){for(var r=1;r<arguments.length;r++)n[i]*=arguments[r][i]/255;n[i]=Math.round(n[i])}return n},multiply_:function(t,e){for(var n=0;n<3;n++){for(var i=1;i<arguments.length;i++)t[n]*=arguments[i][n]/255;t[n]=Math.round(t[n])}return t},interpolate:function(t,e,n){arguments.length<3&&(n=.5);for(var i=t.slice(),r=0;r<3;r++)i[r]=Math.round(i[r]+n*(e[r]-t[r]));return i},interpolateHSL:function(t,e,n){arguments.length<3&&(n=.5);for(var i=this.rgb2hsl(t),r=this.rgb2hsl(e),o=0;o<3;o++)i[o]+=n*(r[o]-i[o]);return this.hsl2rgb(i)},randomize:function(e,n){n instanceof Array||(n=Math.round(t.RNG.getNormal(0,n)));for(var i=e.slice(),r=0;r<3;r++)i[r]+=n instanceof Array?Math.round(t.RNG.getNormal(0,n[r])):n;return i},rgb2hsl:function(t){var e,n,i=t[0]/255,r=t[1]/255,o=t[2]/255,s=Math.max(i,r,o),a=Math.min(i,r,o),c=(s+a)/2;if(s==a)e=n=0;else{var u=s-a;switch(n=c>.5?u/(2-s-a):u/(s+a),s){case i:e=(r-o)/u+(r<o?6:0);break;case r:e=(o-i)/u+2;break;case o:e=(i-r)/u+4}e/=6}return[e,n,c]},hsl2rgb:function(t){var e=t[2];if(0==t[1])return[e=Math.round(255*e),e,e];var n=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},i=t[1],r=e<.5?e*(1+i):e+i-e*i,o=2*e-r,s=n(o,r,t[0]+1/3),a=n(o,r,t[0]),c=n(o,r,t[0]-1/3);return[Math.round(255*s),Math.round(255*a),Math.round(255*c)]},toRGB:function(t){return"rgb("+this._clamp(t[0])+","+this._clamp(t[1])+","+this._clamp(t[2])+")"},toHex:function(t){for(var e=[],n=0;n<3;n++)e.push(this._clamp(t[n]).toString(16).lpad("0",2));return"#"+e.join("")},_clamp:function(t){return t<0?0:t>255?255:t},_cache:{black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},t.Lighting=function(t,e){this._reflectivityCallback=t,this._options={passes:1,emissionThreshold:100,range:10},this._fov=null,this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(e)},t.Lighting.prototype.setOptions=function(t){for(var e in t)this._options[e]=t[e];return t&&t.range&&this.reset(),this},t.Lighting.prototype.setFOV=function(t){return this._fov=t,this._fovCache={},this},t.Lighting.prototype.setLight=function(e,n,i){var r=e+","+n;return i?this._lights[r]="string"==typeof i?t.Color.fromString(i):i:delete this._lights[r],this},t.Lighting.prototype.clearLights=function(){this._lights={}},t.Lighting.prototype.reset=function(){return this._reflectivityCache={},this._fovCache={},this},t.Lighting.prototype.compute=function(e){var n={},i={},r={};for(var o in this._lights){var s=this._lights[o];i[o]=[0,0,0],t.Color.add_(i[o],s)}for(var a=0;a<this._options.passes;a++)this._emitLight(i,r,n),a+1!=this._options.passes&&(i=this._computeEmitters(r,n));for(var c in r){var u=c.split(",");e(parseInt(u[0]),parseInt(u[1]),r[c])}return this},t.Lighting.prototype._emitLight=function(t,e,n){for(var i in t){var r=i.split(","),o=parseInt(r[0]),s=parseInt(r[1]);this._emitLightFromCell(o,s,t[i],e),n[i]=1}return this},t.Lighting.prototype._computeEmitters=function(t,e){var n={};for(var i in t)if(!(i in e)){var r=t[i];if(i in this._reflectivityCache)var o=this._reflectivityCache[i];else{var s=i.split(","),a=parseInt(s[0]),c=parseInt(s[1]);o=this._reflectivityCallback(a,c),this._reflectivityCache[i]=o}if(0!=o){for(var u=[],h=0,l=0;l<3;l++){var p=Math.round(r[l]*o);u[l]=p,h+=p}h>this._options.emissionThreshold&&(n[i]=u)}}return n},t.Lighting.prototype._emitLightFromCell=function(t,e,n,i){var r=t+","+e;if(r in this._fovCache)var o=this._fovCache[r];else o=this._updateFOV(t,e);for(var s in o){var a=o[s];if(s in i)var c=i[s];else c=[0,0,0],i[s]=c;for(var u=0;u<3;u++)c[u]+=Math.round(n[u]*a)}return this},t.Lighting.prototype._updateFOV=function(t,e){var n=t+","+e,i={};this._fovCache[n]=i;var r=this._options.range;return this._fov.compute(t,e,r,function(t,e,n,o){var s=o*(1-n/r);0!=s&&(i[t+","+e]=s)}.bind(this)),i},t.Path=function(e,n,i,r){for(var o in this._toX=e,this._toY=n,this._fromX=null,this._fromY=null,this._passableCallback=i,this._options={topology:8},r)this._options[o]=r[o];this._dirs=t.DIRS[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])},t.Path.prototype.compute=function(t,e,n){},t.Path.prototype._getNeighbors=function(t,e){for(var n=[],i=0;i<this._dirs.length;i++){var r=this._dirs[i],o=t+r[0],s=e+r[1];this._passableCallback(o,s)&&n.push([o,s])}return n},t.Path.Dijkstra=function(e,n,i,r){t.Path.call(this,e,n,i,r),this._computed={},this._todo=[],this._add(e,n,null)},t.Path.Dijkstra.extend(t.Path),t.Path.Dijkstra.prototype.compute=function(t,e,n){var i=t+","+e;if(i in this._computed||this._compute(t,e),i in this._computed)for(var r=this._computed[i];r;)n(r.x,r.y),r=r.prev},t.Path.Dijkstra.prototype._compute=function(t,e){for(;this._todo.length;){var n=this._todo.shift();if(n.x==t&&n.y==e)return;for(var i=this._getNeighbors(n.x,n.y),r=0;r<i.length;r++){var o=i[r],s=o[0],a=o[1];s+","+a in this._computed||this._add(s,a,n)}}},t.Path.Dijkstra.prototype._add=function(t,e,n){var i={x:t,y:e,prev:n};this._computed[t+","+e]=i,this._todo.push(i)},t.Path.AStar=function(e,n,i,r){t.Path.call(this,e,n,i,r),this._todo=[],this._done={},this._fromX=null,this._fromY=null},t.Path.AStar.extend(t.Path),t.Path.AStar.prototype.compute=function(t,e,n){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;)if(!((o=(u=this._todo.shift()).x+","+u.y)in this._done)){if(this._done[o]=u,u.x==t&&u.y==e)break;for(var i=this._getNeighbors(u.x,u.y),r=0;r<i.length;r++){var o,s=i[r],a=s[0],c=s[1];(o=a+","+c)in this._done||this._add(a,c,u)}}var u;if(u=this._done[t+","+e])for(;u;)n(u.x,u.y),u=u.prev},t.Path.AStar.prototype._add=function(t,e,n){for(var i=this._distance(t,e),r={x:t,y:e,prev:n,g:n?n.g+1:0,h:i},o=r.g+r.h,s=0;s<this._todo.length;s++){var a=this._todo[s],c=a.g+a.h;if(o<c||o==c&&i<a.h)return void this._todo.splice(s,0,r)}this._todo.push(r)},t.Path.AStar.prototype._distance=function(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:var n=Math.abs(t-this._fromX),i=Math.abs(e-this._fromY);return i+Math.max(0,(n-i)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}throw new Error("Illegal topology")},t.Display.Term=function(e){t.Display.Backend.call(this,e),this._cx=-1,this._cy=-1,this._lastColor="",this._options={},this._ox=0,this._oy=0,this._termcolor={}},t.Display.Term.extend(t.Display.Backend),t.Display.Term.prototype.compute=function(e){this._options=e,this._ox=Math.floor((i.stdout.columns-e.width)/2),this._oy=Math.floor((i.stdout.rows-e.height)/2),this._termcolor=new(t.Display.Term[e.termColor.capitalize()])(this._context),this._context._termcolor=this._termcolor},t.Display.Term.prototype.draw=function(t,e){var n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],c=this._ox+n,u=this._oy+r;if(!(c<0||c>=i.stdout.columns)&&!(u<0||u>=i.stdout.rows)&&(c===this._cx&&u===this._cy||(i.stdout.write(this._termcolor.positionToAnsi(c,u)),this._cx=c,this._cy=u),e&&(o||(o=" ")),o)){var h=this._termcolor.colorToAnsi(s,a);h!==this._lastColor&&(i.stdout.write(h),this._lastColor=h);var l=[].concat(o);i.stdout.write(l[0]),this._cx++,this._cx>=i.stdout.columns&&(this._cx=0,this._cy++)}},t.Display.Term.prototype.computeSize=function(t,e){return[i.stdout.columns,i.stdout.rows]},t.Display.Term.prototype.computeFontSize=function(t,e){return 12},t.Display.Term.prototype.eventToPosition=function(t,e){return[t,e]},t.Display.Term.Color=function(t){this._context=t},t.Display.Term.Color.prototype.clearToAnsi=function(t){},t.Display.Term.Color.prototype.colorToAnsi=function(t,e){},t.Display.Term.Color.prototype.positionToAnsi=function(t,e){},t.Display.Term.Xterm=function(e){t.Display.Term.Color.call(this,e)},t.Display.Term.Xterm.extend(t.Display.Term.Color),t.Display.Term.Xterm.prototype.clearToAnsi=function(t){return"[0;48;5;"+this._termcolor(t)+"m[2J"},t.Display.Term.Xterm.prototype.colorToAnsi=function(t,e){return"[0;38;5;"+this._termcolor(t)+";48;5;"+this._termcolor(e)+"m"},t.Display.Term.Xterm.prototype.positionToAnsi=function(t,e){return"["+(e+1)+";"+(t+1)+"H"},t.Display.Term.Xterm.prototype._termcolor=function(e){var n=t.Color.fromString(e);return 36*Math.floor(n[0]*(6/256))+6*Math.floor(n[1]*(6/256))+1*Math.floor(n[2]*(6/256))+16},t)e[n]=t[n];return t})?r.apply(e,o):r)||(t.exports=s)}).call(this,n(42),n(43))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(16);e.Entity=class{constructor(t,e,n,i,r,o,s,a,c=null,u=null,h=null,l=null,p=null,d=!0,f=null){this.id=t,this.x=e,this.y=n,this.color=i,this.symbol=r,this.isBlocking=o,this.name=s,this.renderOrder=a,this.item=c,this.inventory=u,this.stairs=h,this.equipment=l,this.equippable=p,this.isActive=d,this.mapId=f,this.item&&(this.item.owner=this),this.inventory&&(this.inventory.owner=this),this.stairs&&(this.stairs.owner=this),this.equipment&&(this.equipment.owner=this),this.equippable&&(this.equippable.owner=this)}distanceTo(t){return this.distanceToPos(t.x,t.y)}distanceToPos(t,e){const n=t-this.x,i=e-this.y;return Math.sqrt(n*n+i*i)}move(t,e){this.x+=t,this.y+=e}moveAstar(t,e,n){let r=!1;new i.Path.AStar(t.x,t.y,(t,i)=>!e.isBlocked(t,i)&&!n.some(e=>e.x===t&&e.y===i)).compute(this.x,this.y,(t,e)=>{r||(r=!0,this.x=t,this.y=e)}),r||this.moveTowards(t.x,t.y,e,n)}moveTowards(t,e,n,i){let r=t-this.x,o=e-this.y;const s=Math.sqrt(r*r+o*o);r=Math.round(r/s),o=Math.round(o/s),n.isBlocked(this.x+r,this.y+o)||i.some(t=>t.x===this.x+r&&t.y===this.y+o)||this.move(r,o)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.PLAYER_TURN=0]="PLAYER_TURN",t[t.ENEMY_TURN=1]="ENEMY_TURN",t[t.PLAYER_DEAD=2]="PLAYER_DEAD",t[t.SHOW_INVENTORY=3]="SHOW_INVENTORY",t[t.TARGETING=4]="TARGETING",t[t.MAIN_MENU=5]="MAIN_MENU",t[t.LEVEL_UP=6]="LEVEL_UP",t[t.SHOW_CHARACTER_PANEL=7]="SHOW_CHARACTER_PANEL"}(e.GameState||(e.GameState={}))},function(t,e,n){"use strict";var i=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(e,"__esModule",{value:!0});let r=class{constructor(){this.systems=[]}addSystem(t){this.systems.push(t)}dispatchEvent(t,e){let n=[];for(const i of this.systems)n=n.concat(i.onEvent(t,e));return n}};r=i([n(8).injectable()],r),e.SystemService=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.randomInt=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.MapService=class{constructor(){this._maps=[],this.currentMapId=0,this.mapId=0}addMap(t){t.id=this.mapId++,this._maps.push(t)}clearMaps(){this._maps=[]}getCurrentMap(){return this._maps[this.currentMapId]}getCurrentMapId(){return this.currentMapId}setCurrentMap(t){if(t<0||t>this.mapId)throw new Error("Map ID out of range!");this.currentMapId=t}get maps(){return this._maps}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(23),r=n(36),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new i.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=r.namedConstraint(t),new i.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new i.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=r.taggedConstraint(t)(e),new i.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return r.typeConstraint(t)(e.parentRequest)},new i.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return r.namedConstraint(t)(e.parentRequest)},new i.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return r.taggedConstraint(t)(e)(n.parentRequest)},new i.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return r.traverseAncerstors(e,r.typeConstraint(t))},new i.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!r.traverseAncerstors(e,r.typeConstraint(t))},new i.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return r.traverseAncerstors(e,r.namedConstraint(t))},new i.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!r.traverseAncerstors(e,r.namedConstraint(t))},new i.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return r.traverseAncerstors(n,r.taggedConstraint(t)(e))},new i.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!r.traverseAncerstors(n,r.taggedConstraint(t)(e))},new i.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return r.traverseAncerstors(e,t)},new i.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!r.traverseAncerstors(e,t)},new i.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(22),r=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new i.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e=1,n=0,i=200,r=150){this.ownerId=t,this.currentLevel=e,this.currentXp=n,this.levelUpBase=i,this.levelUpFactor=r,this.isActive=!0,this.type="LevelComponent"}static addXp(t,e){return t.currentXp+=e,t.currentXp>i.xpToLevel(t)&&(t.currentXp-=i.xpToLevel(t),t.currentLevel++,!0)}static xpToLevel(t){return t.levelUpBase+t.levelUpFactor*t.currentLevel}}e.LevelComponent=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,n){this.x=t,this._height=e,this.width=n,this.messages=[]}static fromOtherMessageLog(t){const e=new i(t.x,t._height,t.width);return e.messages=[...e.messages],e}addMessage(t){this.messages.push(t),this.sliceExcessMessages()}set height(t){this._height=t,this.sliceExcessMessages()}sliceExcessMessages(){if(this.messages.length>this._height){const t=this.messages.length-this._height;this.messages=this.messages.slice(t)}}}e.MessageLog=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(12);e.Equipment=class{constructor(){this.equipped=new Array(i.EquipmentSlot.COUNT)}static getMaxHpBonus(t){return t.equipped.reduce((t,e)=>t+(e?e.maxHpBonus:0),0)}static getPowerBonus(t){return t.equipped.reduce((t,e)=>t+(e?e.powerBonus:0),0)}static getDefenseBonus(t){return t.equipped.reduce((t,e)=>t+(e?e.defenseBonus:0),0)}static toggleEquip(t,e){const n=[];return t.equipped[e.slot]===e?(t.equipped[e.slot]=null,n.push({dequipped:e.owner})):(t.equipped[e.slot]&&n.push({dequipped:t.equipped[e.slot].owner}),t.equipped[e.slot]=e,n.push({equipped:e.owner})),n}toJSON(){const t=Object.assign({},this);return t._ownerId=t.owner.id,t.owner=void 0,t._type="Equipment",t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(5),r=n(14),o=n(11),s=n(3),a=i.container.get("ComponentService"),c=i.container.get("SystemService");e.LightningScroll=class{constructor(t,e,n){this.damage=t,this.maxRange=e,this._name="Lightning Scroll",n&&(this._name=n)}use(t,e,n){let i=[],u=[];n.computeFov(t.x,t.y,o.CONSTANTS.PLAYER_FOV,(t,n)=>{u=u.concat(e.filter(e=>e.x===t&&e.y===n&&a.entityHasComponentOfType(e.id,"FighterComponent")))});const h=u.map((e,n)=>({idx:n,dist:t.distanceTo(e)})).filter(t=>t.dist<this.maxRange).sort(t=>t.dist);if(h.length>1){const t=u[h[1].idx];i.push({consumed:!0,message:new s.Message(`A lightning bolt strikes ${t.name} for ${this.damage} damage.`,"white"),target:t}),i=i.concat(c.dispatchEvent(t.id,new r.TakeDamageEvent(this.damage)))}else i.push({consumed:!1,message:new s.Message("There are no targets in range.","red")});return i}get name(){return this._name}toJSON(){const t=Object.assign({},this);return t._ownerId=t.owner.id,t.owner=void 0,t._type="LightningScroll",t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(5),r=n(3),o=i.container.get("ComponentService");e.HealingPotion=class{constructor(t,e="Healing Potion"){this.healAmount=t,this.name=e}use(t,e){const n=[],i=o.getComponentByEntityIdAndType(t.id,"FighterComponent");return i?i.currHp>=i.baseMaxHp?(n.push({consumed:!1,message:new r.Message("You are already at full health.","yellow")}),n):i.currHp<=0?(n.push({consumed:!1,message:new r.Message("You are dead. The potion doesn't really help.","yellow")}),n):(n.push({consumed:!0,message:new r.Message("Your wounds start to feel better!","green")}),i.currHp+=this.healAmount,i.currHp>i.baseMaxHp&&(i.currHp=i.baseMaxHp),n):(n.push({consumed:!1,message:new r.Message(`${t.name} tries to use a healing potion, but realizes it can't do so.`,"red")}),n)}toJSON(){const t=Object.assign({},this);return t._ownerId=t.owner.id,t.owner=void 0,t._type="HealingPotion",t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,n=1){this.height=t,this.width=e,this.dungeonLevel=n,this.tiles=[];for(let t=0;t<this.width;++t){this.tiles[t]=[];for(let e=0;e<this.height;++e)this.tiles[t].push({blocksSight:!0,isBlocked:!0,isSeen:!1})}}static fromOtherMap(t){const e=new i(t.height,t.width,t.dungeonLevel);for(let n=0;n<e.width;++n)for(let i=0;i<e.height;++i)e.tiles[n][i]=Object.assign({},t.tiles[n][i]);return e}getTile(t,e){return t<0||t>=this.width||e<0||e>=this.height?null:this.tiles[t][e]}isBlocked(t,e){const n=this.getTile(t,e);return!n||n.isBlocked}}e.GameMap=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(5),r=n(14),o=n(11),s=n(3),a=i.container.get("ComponentService"),c=i.container.get("SystemService");e.FireballScroll=class{constructor(t,e){this.damage=t,this.radius=e,this.requiresTarget=!0,this.name="Fireball Scroll"}use(t,e,n,i,u){let h=[],l=!1;if(n.computeFov(t.x,t.y,o.CONSTANTS.PLAYER_FOV,(t,e)=>{t===i&&e===u&&(l=!0)}),!l)return h.push({consumed:!1,message:new s.Message("You cannot target a tile outside your field of view.","yellow")}),h;h.push({consumed:!0,message:new s.Message(`The fireball explodes, burning everything with ${this.radius} tiles!`,"orange")});const p=e.filter(t=>t.distanceToPos(i,u)<=this.radius&&a.entityHasComponentOfType(t.id,"FighterComponent"));for(const t of p)h.push({message:new s.Message(`The ${t[0].name} is burned for ${this.damage} hit points.`,"orange")}),h=h.concat(c.dispatchEvent(t.id,new r.TakeDamageEvent(this.damage)));return h}toJSON(){const t=Object.assign({},this);return t._ownerId=t.owner.id,t.owner=void 0,t._type="FireballScroll",t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(55),r=n(5),o=n(11),s=n(3),a=r.container.get("ComponentService"),c=r.container.get("EntityService");e.ConfusionScroll=class{constructor(t){this.numTurns=t,this.name="Confusion Scroll",this.requiresTarget=!0}use(t,e,n,r,u){const h=[];let l=!1;if(n.computeFov(t.x,t.y,o.CONSTANTS.PLAYER_FOV,(t,e)=>{t===r&&e===u&&(l=!0)}),!l)return h.push({consumed:!1,message:new s.Message("You cannot target a tile outside your field of view.","yellow")}),h;const p=[],d=c.getEntitiesAtPos(r,u);for(const t of d)a.getComponentsForEntityIdAndTypes(t.id,["BasicMonsterAiComponent","ConfusedMonsterAiComponent"]).length>0&&p.push(t);if(p.length<1)return h.push({consumed:!1,message:new s.Message("There is nothing to target at that location.","yellow")}),h;const f=p[p.length-1],_=a.getComponentsForEntityIdAndTypes(f.id,["BasicMonsterAiComponent","ConfusedMonsterAiComponent"]);return a.addComponent(new i.ConfusedMonsterAiComponent(f.id,this.numTurns,_.length>0?_[0].id:null)),h.push({consumed:!0,message:new s.Message(`The eyes of the ${f.name} look vacant as it starts to stumble around.`,"lightgreen")}),h}toJSON(){const t=Object.assign({},this);return t._ownerId=t.owner.id,t.owner=void 0,t._type="ConfusionScroll",t}}},function(t,e,n){"use strict";var i=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},r=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},o=this&&this.__param||function(t,e){return function(n,i){e(n,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(8),a=n(56),c=n(9),u=n(33),h=n(31),l=n(15),p=n(17),d=n(12),f=n(30),_=n(29),g=n(28),y=n(27),m=n(54),v=n(20),T=n(53),S=n(52),w=n(13),E=n(51);let M=class{constructor(t,e){this.entityService=t,this.componentService=e,this.entityId=1}generate(t,e,n){this.opts={height:t.height||m.DEFAULT_OPTIONS.height,width:t.width||m.DEFAULT_OPTIONS.width,maxRooms:t.maxRooms||m.DEFAULT_OPTIONS.maxRooms,roomMaxSize:t.roomMaxSize||m.DEFAULT_OPTIONS.roomMaxSize,roomMinSize:t.roomMinSize||m.DEFAULT_OPTIONS.roomMinSize};const i=new _.GameMap(this.opts.height,this.opts.width,n);let r=0;const o=[];for(let t=0;t<this.opts.maxRooms;++t){const t=v.randomInt(this.opts.roomMinSize,this.opts.roomMaxSize),e=v.randomInt(this.opts.roomMinSize,this.opts.roomMaxSize),s=v.randomInt(0,this.opts.width-e-1),a=v.randomInt(0,this.opts.height-t-1),c=new S.Rect(s,a,e,t);if(!o.some(t=>t.intersects(c))){if(this.createRoom(i,c),0!==r){const[t,e]=c.getCenter(),[n,s]=o[r-1].getCenter();1===v.randomInt(0,1)?(this.createHorizontalTunnel(i,n,t,s),this.createVerticalTunnel(i,s,e,t)):(this.createVerticalTunnel(i,s,e,n),this.createHorizontalTunnel(i,n,t,e))}r++,o.push(c),this.placeEntities(c,n)}}const s=o[0].getCenter();e&&(e.x=s[0],e.y=s[1]),i.dungeonLevel>1&&this.entityService.addEntity(new p.Entity(this.entityId++,s[0],s[1],"white",">",!1,"Stairs",w.RenderOrder.STAIRS,null,null,new E.Stairs(i.dungeonLevel-1)));const a=o[o.length-1].getCenter();return this.entityService.addEntity(new p.Entity(this.entityId++,a[0],a[1],"white",">",!1,"Stairs",w.RenderOrder.STAIRS,null,null,new E.Stairs(i.dungeonLevel+1))),i}createHorizontalTunnel(t,e,n,i){if(e<0||n<0||e>this.opts.width||n>this.opts.width)throw new Error(`Out of bounds! (Width: ${this.opts.width}, x1: ${e}, x2: ${n})`);for(let r=Math.min(e,n);r<Math.max(e,n)+1;++r){const e=t.getTile(r,i);e.isBlocked=!1,e.blocksSight=!1}}createVerticalTunnel(t,e,n,i){if(e<0||n<0||e>this.opts.height||n>this.opts.height)throw new Error(`Out of bounds! (Height: ${this.opts.height}, y1: ${e}, y2: ${n})`);for(let r=Math.min(e,n);r<Math.max(e,n)+1;++r){const e=t.getTile(i,r);e.isBlocked=!1,e.blocksSight=!1}}createRoom(t,e){const n=e.getX(),i=e.getY(),r=e.getX2(),o=e.getY2();if(n<0||i<0||r<0||o<0||n>this.opts.width||r>this.opts.width||i>this.opts.height||o>this.opts.height||n>r||i>o)throw new Error("Out of bounds!"+` (Height: ${this.opts.height},`+` Width: ${this.opts.width},`+` x1: ${n}, x2: ${r},`+` y1: ${i}, y2: ${o})`);for(let e=n+1;e<r;++e)for(let n=i+1;n<o;++n){const i=t.getTile(e,n);i.isBlocked=!1,i.blocksSight=!1}}placeEntities(t,e){const n=T.fromDungeonLevel([[1,1],[4,2]],e),i=T.fromDungeonLevel([[1,2],[4,3],[6,5]],e),r=v.randomInt(0,n),o=v.randomInt(0,i),s={orc:80,troll:T.fromDungeonLevel([[3,15],[5,30],[7,60]],e)},c={confusionScroll:T.fromDungeonLevel([[2,10]],e),fireballScroll:T.fromDungeonLevel([[6,25]],e),healingPotion:35,lightningScroll:T.fromDungeonLevel([[4,25]],e),shield:T.fromDungeonLevel([[8,15]],e),sword:T.fromDungeonLevel([[4,5]],e)};for(let e=0;e<r;++e){const e=v.randomInt(t.getX()+1,t.getX2()-1),n=v.randomInt(t.getY()+1,t.getY2()-1);if(!this.entityService.getEntitiesAtPos(e,n).some(t=>t.isActive)){let t=null;const i=T.randomChoiceFromMap(c);"lightningScroll"===i?t=new p.Entity(this.entityId++,e,n,"yellow","#",!1,"Lightning Scroll",w.RenderOrder.ITEM,new y.LightningScroll(40,5)):"fireballScroll"===i?t=new p.Entity(this.entityId++,e,n,"red","#",!1,"Fireball Scroll",w.RenderOrder.ITEM,new f.FireballScroll(25,3)):"confusionScroll"===i?t=new p.Entity(this.entityId++,e,n,"lightpink","#",!1,"Confusion Scroll",w.RenderOrder.ITEM,new h.ConfusionScroll(10)):"healingPotion"===i?t=new p.Entity(this.entityId++,e,n,"violet","!",!1,"Healing Potion",w.RenderOrder.ITEM,new g.HealingPotion(40)):"shield"===i?t=new p.Entity(this.entityId++,e,n,"darkorange","[",!1,"Shield",w.RenderOrder.ITEM,null,null,null,null,new d.Equippable(d.EquipmentSlot.OFF_HAND,0,1,0)):"sword"===i&&(t=new p.Entity(this.entityId++,e,n,"skyblue","刀",!1,"Sword",w.RenderOrder.ITEM,null,null,null,null,new d.Equippable(d.EquipmentSlot.MAIN_HAND,3,0,0))),this.entityService.addEntity(t)}}for(let e=0;e<o;++e){const e=v.randomInt(t.getX()+1,t.getX2()-1),n=v.randomInt(t.getY()+1,t.getY2()-1);if(!this.entityService.getEntitiesAtPos(e,n).some(t=>t.isActive)){let t=null;const i=T.randomChoiceFromMap(s);"orc"===i?(t=new p.Entity(this.entityId++,e,n,"white","O",!0,"Orc",w.RenderOrder.ACTOR),this.componentService.addComponent(new u.FighterComponent(t.id,20,0,4,35))):"troll"===i&&(t=new p.Entity(this.entityId++,e,n,"white","T",!0,"Troll",w.RenderOrder.ACTOR),this.componentService.addComponent(new u.FighterComponent(t.id,30,2,8,100))),this.entityService.addEntity(t),this.componentService.addComponent(new a.BasicMonsterAiComponent(t.id))}}}};M=i([s.injectable(),o(0,s.inject("EntityService")),o(1,s.inject("ComponentService")),r("design:paramtypes",[l.EntityService,c.ComponentService])],M),e.TutorialMapGenerator=M},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.FighterComponent=class{constructor(t,e,n,i,r=0){this.ownerId=t,this.baseDefense=n,this.basePower=i,this.xp=r,this.isActive=!0,this.type="FighterComponent",this.currHp=e,this.baseMaxHp=e}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.AttackEvent=class{constructor(t){this.attackerId=t,this.type="AttackEvent"}}},function(t,e,n){"use strict";var i=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},r=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},o=this&&this.__param||function(t,e){return function(n,i){e(n,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(8),a=n(16),c=n(21);let u=class{constructor(t){this.maps=t,this.fov=new a.FOV.PreciseShadowcasting((t,e)=>{const n=this.maps.getCurrentMap();return!(t<0||t>=n.width||e<0||e>=n.height)&&!n.getTile(t,e).blocksSight})}computeFov(t,e,n,i){const r=[];return this.fov.compute(t,e,n,(t,e)=>{const n=i(t,e);r.push(n)}),r}};u=i([s.injectable(),o(0,s.inject("MapService")),r("design:paramtypes",[c.MapService])],u),e.FovService=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(2),o=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||o(n,e))};e.traverseAncerstors=o;var s=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new r.Metadata(t,e),n}};e.taggedConstraint=s;var a=s(i.NAMED_TAG);e.namedConstraint=a;e.typeConstraint=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t;var i=e.bindings[0].implementationType;return t===i}return!1}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(23),r=n(22),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new r.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(7),o=n(2),s=n(82),a=function(){function t(t,e,n,a){this.guid=r.guid(),this.type=t,this.serviceIdentifier=n,this.name=new s.QueryableString(e||""),this.metadata=new Array;var c=null;"string"==typeof a?c=new o.Metadata(i.NAMED_TAG,a):a instanceof o.Metadata&&(c=a),null!==c&&this.metadata.push(c)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++){if(n[e].key===t)return!0}return!1},t.prototype.isArray=function(){return this.hasTag(i.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(i.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(i.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some(function(t){return t.key!==i.INJECT_TAG&&t.key!==i.MULTI_INJECT_TAG&&t.key!==i.NAME_TAG&&t.key!==i.UNMANAGED_TAG&&t.key!==i.NAMED_TAG})},t.prototype.isOptional=function(){return this.matchesTag(i.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(t){return t.key===i.NAMED_TAG})[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(t){return t.key!==i.INJECT_TAG&&t.key!==i.MULTI_INJECT_TAG&&t.key!==i.NAME_TAG&&t.key!==i.UNMANAGED_TAG&&t.key!==i.NAMED_TAG}):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(i.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var i=0,r=e.metadata;i<r.length;i++){var o=r[i];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(2),s=n(6),a=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=a,e.inject=function(t){return function(e,n,a){if(void 0===t)throw new Error(i.UNDEFINED_INJECT_ANNOTATION(e.name));var c=new o.Metadata(r.INJECT_TAG,t);"number"==typeof a?s.tagParameter(e,n,a,c):s.tagProperty(e,n,c)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===i.STACK_OVERFLOW}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(i.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(i.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(i.TAGGED_PROP,t)||[]},t}();e.MetadataReader=r},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var c,u=[],h=!1,l=-1;function p(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!h){var t=a(p);h=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,h=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function _(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new f(t,e)),1!==u.length||h||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=_,r.addListener=_,r.once=_,r.off=_,r.removeListener=_,r.removeAllListeners=_,r.emit=_,r.prependListener=_,r.prependOnceListener=_,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.saveGame=function(t,e,n,i,r,o){localStorage.setItem("savedGame",JSON.stringify({currentMap:i,entities:e,gameMaps:n,gameState:o,messageLog:r,playerIndex:e.indexOf(t)}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.menu=function(t,e,n,i,r,o,s){if(n.length>26)throw new Error("Cannot have a menu with more than 26 options.");const a=Math.floor(o/2-r/2),c=Math.floor(s/2-13.5);t.drawText(a,c,e,r);let u=1;for(const e of n){let n=e;u===i+1&&(n="%b{blue}"+e),t.drawText(a,c+u,n,r),u++}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(29),r=n(25);e.loadGame=function(t){const e={currentMap:t.currentMap,entities:[],gameMaps:[],gameState:null,messageLog:null,player:null};for(const n of t.gameMaps)e.gameMaps.push(i.GameMap.fromOtherMap(n));return e.gameState=t.gameState,e.messageLog=r.MessageLog.fromOtherMessageLog(t.messageLog),e.entities=t.entities,e.player=e.entities[t.playerIndex],e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(31),r=n(17),o=n(12),s=n(30),a=n(28),c=n(27),u=n(13);e.itemFromObject=function(t){switch(t.name){case"Confusion Scroll":return new r.Entity(t.id,0,0,"lightpink","#",!1,"Confusion Scroll",u.RenderOrder.ITEM,new i.ConfusionScroll(t.item.numTurns));case"Fireball Scroll":return new r.Entity(t.id,0,0,"red","#",!1,"Fireball Scroll",u.RenderOrder.ITEM,new s.FireballScroll(t.item.damage,t.item.radius));case"Healing Potion":return new r.Entity(t.id,0,0,"violet","!",!1,"Healing Potion",u.RenderOrder.ITEM,new a.HealingPotion(t.item.healAmount));case"Lightning Scroll":return new r.Entity(t.id,0,0,"yellow","#",!1,"Lightning Scroll",u.RenderOrder.ITEM,new c.LightningScroll(t.item.damage,t.item.maxRange));case"Shield":return new r.Entity(t.id,0,0,"darkorange","[",!1,"Shield",u.RenderOrder.ITEM,null,null,null,null,new o.Equippable(o.EquipmentSlot.OFF_HAND,0,1,0));case"Sword":return new r.Entity(t.id,0,0,"skyblue","刀",!1,"Sword",u.RenderOrder.ITEM,null,null,null,null,new o.Equippable(o.EquipmentSlot.MAIN_HAND,3,0,0))}return null}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(26),r=n(47),o=n(3);e.inventoryFromObject=function(t){switch(t._type){case"Inventory":const e=new s(t.capacity);for(const n of t.items)e.items.push(r.itemFromObject(n));return e}return null};class s{constructor(t){this.capacity=t,this.items=[]}addItem(t){const e=[];return this.items.length>=this.capacity?e.push({message:new o.Message("Your inventory is full.","yellow")}):(e.push({itemAdded:t,message:new o.Message(`You pick up the ${t.name}!`,"blue")}),this.items.push(t)),e}dropItem(t,e){const n=[];if(t>=this.items.length||t<0)return n.push({message:new o.Message(`${this.owner.name} tries to drop an item that they don't have. How silly!`,"red")}),n;const r=this.items[t];return this.owner.equipment&&r.equippable&&this.owner.equipment.equipped.includes(r.equippable)&&i.Equipment.toggleEquip(this.owner.equipment,r.equippable),r.x=this.owner.x,r.y=this.owner.y,this.items.splice(t,1),n.push({itemDropped:r,message:new o.Message(`You drop the ${r.name}.`,"yellow")}),n}useItem(t,e,n,i,r){let s=[];if(t>=this.items.length||t<0)return s.push({message:new o.Message(`${this.owner.name} tries to use an item that they don't have. How silly!`,"red")}),s;if(!this.items[t].item)return this.items[t].equippable?s.push({equip:this.items[t]}):s.push({message:new o.Message(`The ${this.items[t].name} cannot be used.`,"yellow")}),s;if(this.items[t].item.requiresTarget&&void 0===i&&void 0===r)return s.push({targeting:this.items[t]}),s;const a=this.items[t].item.use(this.owner,e,n,i,r);return a.some(t=>t.consumed)&&this.items.splice(t,1),s=s.concat(a)}toJSON(){const t=Object.assign({},this);return t._ownerId=t.owner.id,t.owner=void 0,t._type="Inventory",t}}e.Inventory=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ThinkEvent=class{constructor(){this.type="ThinkEvent"}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.GainXpEvent=class{constructor(t){this.xp=t,this.type="GainXpEvent"}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Stairs=class{constructor(t){this.floor=t}toJSON(){const t=Object.assign({},this);return t._ownerId=t.owner.id,t.owner=void 0,t._type="Stairs",t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Rect=class{constructor(t,e,n,i){this.x=t,this.y=e,this.x2=t+n,this.y2=e+i}getCenter(){return[Math.floor((this.x+this.x2)/2),Math.floor((this.y+this.y2)/2)]}getX(){return this.x}getY(){return this.y}getX2(){return this.x2}getY2(){return this.y2}intersects(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(20);function r(t){const e=i.randomInt(0,t.reduce((t,e)=>t+e,0));let n=0,r=0;for(const i of t){if(e<=(n+=i))return r;r+=1}return r}e.fromDungeonLevel=function(t,e){for(const n of t)if(e>=n[0])return n[1];return 0},e.randomChoiceIndex=r,e.randomChoiceFromMap=function(t){return Object.keys(t)[r(Object.values(t))]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS={height:45,width:80,maxRooms:30,roomMaxSize:10,roomMinSize:6}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ConfusedMonsterAiComponent=class{constructor(t,e,n){this.ownerId=t,this.numTurns=e,this.previousAiId=n,this.isActive=!0,this.type="ConfusedMonsterAiComponent"}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.BasicMonsterAiComponent=class{constructor(t){this.ownerId=t,this.isActive=!0,this.type="BasicMonsterAiComponent"}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(5),r=n(11),o=n(3),s=n(32),a=i.container.get("ComponentService"),c=i.container.get("EntityService");e.enterStairs=function(t,e,n,i,u=new s.TutorialMapGenerator(c,a),h){if(n.some(e=>e.dungeonLevel===t.floor))return n.filter(e=>e.dungeonLevel===t.floor)[0],t.floor-1;{n.push(u.generate({height:r.CONSTANTS.MAP_HEIGHT,width:r.CONSTANTS.MAP_WIDTH},e,t.floor));const s=a.getComponentByEntityIdAndType(e.id,"FighterComponent");return s.currHp+=s.baseMaxHp/2,s.currHp>s.baseMaxHp&&(s.currHp=s.baseMaxHp),i.addMessage(new o.Message("You rest for a moment, recovering your health.","violet")),t.floor-1}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(5),r=n(18),o=i.container.get("EntityService");e.drawTouchIcons=function(t,e,n){const i=document.getElementById("touch-icons");for(;i.firstChild;)i.removeChild(i.firstChild);if(t===r.GameState.SHOW_INVENTORY&&e.inventory.items.length>0){const t=document.createElement("span");t.setAttribute("class","oi"),t.setAttribute("data-glyph","data-transfer-download"),t.ontouchstart=(t=>{t.stopPropagation(),n({type:"drop"})}),i.appendChild(t)}if(t!==r.GameState.MAIN_MENU&&t!==r.GameState.SHOW_INVENTORY&&t!==r.GameState.TARGETING&&t!==r.GameState.SHOW_CHARACTER_PANEL&&t!==r.GameState.LEVEL_UP&&o.entities.some(t=>t.item&&t.x===e.x&&t.y===e.y)){const t=document.createElement("span");t.setAttribute("class","oi"),t.setAttribute("data-glyph","data-transfer-upload"),t.ontouchstart=(t=>{t.stopPropagation(),n({type:"pickup"})}),i.appendChild(t)}if(t!==r.GameState.MAIN_MENU&&t!==r.GameState.SHOW_INVENTORY&&t!==r.GameState.TARGETING&&t!==r.GameState.SHOW_CHARACTER_PANEL&&t!==r.GameState.LEVEL_UP&&o.entities.some(t=>t.stairs&&t.x===e.x&&t.y===e.y)){const t=document.createElement("span");t.setAttribute("class","oi"),t.setAttribute("data-glyph","elevator"),t.ontouchstart=(t=>{t.stopPropagation(),n({type:"enter"})}),i.appendChild(t)}if(t!==r.GameState.MAIN_MENU&&t!==r.GameState.SHOW_INVENTORY&&t!==r.GameState.TARGETING&&t!==r.GameState.SHOW_CHARACTER_PANEL&&t!==r.GameState.LEVEL_UP){const t=document.createElement("span");t.setAttribute("class","oi"),t.setAttribute("data-glyph","briefcase"),t.ontouchstart=(t=>{t.stopPropagation(),n({type:"open-inventory"})}),i.appendChild(t)}if(t!==r.GameState.MAIN_MENU&&t!==r.GameState.SHOW_INVENTORY&&t!==r.GameState.TARGETING&&t!==r.GameState.SHOW_CHARACTER_PANEL&&t!==r.GameState.LEVEL_UP){const t=document.createElement("span");t.setAttribute("class","oi"),t.setAttribute("data-glyph","person"),t.ontouchstart=(t=>{t.stopPropagation(),n({type:"open-character-panel"})}),i.appendChild(t)}if(t!==r.GameState.MAIN_MENU&&t!==r.GameState.LEVEL_UP){const t=document.createElement("span");t.setAttribute("class","oi"),t.setAttribute("data-glyph","circle-x"),t.ontouchstart=(t=>{t.stopPropagation(),n({type:"exit"})}),i.appendChild(t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(5),r=n(18),o=n(3),s=n(13),a=i.container.get("ComponentService");e.killPlayer=function(t){return t.symbol="%",t.color="darkred",t.renderOrder=s.RenderOrder.CORPSE,{message:new o.Message("You died!","red"),state:r.GameState.PLAYER_DEAD}},e.killMonster=function(t){const e=`${t.name.capitalize()} is dead!`;return t.symbol="%",t.color="darkred",t.isBlocking=!1,t.name=`Remains of ${t.name}`,t.renderOrder=s.RenderOrder.CORPSE,a.deleteComponentByOwnerIdAndType(t.id,"BasicMonsterAiComponent"),a.deleteComponentByOwnerIdAndType(t.id,"ConfusedMonsterAiComponent"),a.deleteComponentByOwnerIdAndType(t.id,"FighterComponent"),{message:new o.Message(e,"orange")}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(16);e.COLORS={darkGround:i.Color.toRGB([50,50,150]),darkWall:i.Color.toRGB([0,0,100]),lightGround:i.Color.toRGB([200,180,50]),lightWall:i.Color.toRGB([130,110,50])}},function(t,e,n){"use strict";var i=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},r=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},o=this&&this.__param||function(t,e){return function(n,i){e(n,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(8),a=n(9),c=n(24);let u=class{constructor(t){this.componentService=t}onEvent(t,e){if("GainXpEvent"!==e.type)return[];const n=[],i=this.componentService.getComponentByEntityIdAndType(t,"LevelComponent");if(i){const t=c.LevelComponent.addXp(i,e.xp);n.push({leveledUp:t})}return n}};u=i([s.injectable(),o(0,s.inject("ComponentService")),r("design:paramtypes",[a.ComponentService])],u),e.LevelSystem=u},function(t,e,n){"use strict";var i=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},r=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},o=this&&this.__param||function(t,e){return function(n,i){e(n,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(8),a=n(9),c=n(15),u=n(14),h=n(3),l=n(19);let p=class{constructor(t,e,n){this.entities=t,this.components=e,this.systems=n}onEvent(t,e){if("AttackEvent"!==e.type&&"TakeDamageEvent"!==e.type)return[];const n=this.entities.getEntityById(t),i=this.components.getComponentByEntityIdAndType(t,"FighterComponent");if(!n||!i)return[];switch(e.type){case"AttackEvent":return this.onAttack(t,e,n,i);case"TakeDamageEvent":return this.onTakeDamage(t,e,n,i)}}onAttack(t,e,n,i){let r=[];const o=this.entities.getEntityById(e.attackerId),s=this.components.getComponentByEntityIdAndType(e.attackerId,"FighterComponent");if(!o||!s)return r;const a=s.basePower-i.baseDefense;return a>0?(r.push({message:new h.Message(`${o.name.capitalize()} attacks ${n.name} for ${a} hit points.`,"white")}),r=r.concat(this.systems.dispatchEvent(n.id,new u.TakeDamageEvent(a)))):r.push({message:new h.Message(`${o.name.capitalize()} attacks ${n.name} but does no damage.`,"white")}),r}onTakeDamage(t,e,n,i){if(!n||!i)return[];const r=[];return i.currHp-=e.damage,i.currHp<=0&&r.push({dead:n,xp:i.xp}),r}};p=i([s.injectable(),o(0,s.inject("EntityService")),o(1,s.inject("ComponentService")),o(2,s.inject("SystemService")),r("design:paramtypes",[c.EntityService,a.ComponentService,l.SystemService])],p),e.FighterSystem=p},function(t,e,n){"use strict";var i=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},r=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},o=this&&this.__param||function(t,e){return function(n,i){e(n,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(8),a=n(9),c=n(15),u=n(34),h=n(14),l=n(3),p=n(20),d=n(35),f=n(21),_=n(19);let g=class{constructor(t,e,n,i,r){this.entities=t,this.components=e,this.fov=n,this.maps=i,this.systems=r,this.AI_COMPONENT_TYPES={BasicMonsterAiComponent:t=>this.basicMonsterAiThink(t),ConfusedMonsterAiComponent:(t,e)=>this.confusedMonsterAiThink(t,e)}}onEvent(t,e){if("ThinkEvent"!==e.type)return[];const n=this.components.getComponentsForEntityId(t).filter(t=>Object.keys(this.AI_COMPONENT_TYPES).includes(t.type));if(0===n.length)return[];let i=[];for(const e of n)e.isActive&&(i=i.concat(this.AI_COMPONENT_TYPES[e.type](t,e)));return i}basicMonsterAiThink(t){const e=this.entities.getEntityByName("Player");if(!e)throw new Error("Player not found!");let n=[];const i=this.entities.getEntityById(t);let r=!1;if(this.fov.computeFov(i.x,i.y,10,(t,n)=>{t===e.x&&n===e.y&&(r=!0)}),r){const t=this.components.getComponentByEntityIdAndType(e.id,"FighterComponent");i.distanceTo(e)>=2?i.moveAstar(e,this.maps.getCurrentMap(),this.entities.entities):t&&t.currHp>0&&(n=n.concat(this.systems.dispatchEvent(e.id,new u.AttackEvent(i.id))))}return n}confusedMonsterAiThink(t,e){let n=[];const i=this.entities.getEntityById(t);if(e.numTurns>0){const t=i.x+p.randomInt(0,2)-1,r=i.y+p.randomInt(0,2)-1;t!==i.x&&r!==i.y&&i.moveTowards(t,r,this.maps.getCurrentMap(),this.entities.entities);const o=p.randomInt(0,100),s=this.components.getComponentByEntityIdAndType(i.id,"FighterComponent");s&&0===o&&(n.push({message:new l.Message(`The ${i.name} hurt itself in its confusion!`,"red")}),n=n.concat(this.systems.dispatchEvent(i.id,new h.TakeDamageEvent(s.basePower)))),e.numTurns--}else{this.components.getComponentById(e.previousAiId).isActive=!0,e.isActive=!1,n.push({message:new l.Message(`The ${i.name} is no longer confused!`,"red")})}return n}};g=i([s.injectable(),o(0,s.inject("EntityService")),o(1,s.inject("ComponentService")),o(2,s.inject("FovService")),o(3,s.inject("MapService")),o(4,s.inject("SystemService")),r("design:paramtypes",[c.EntityService,a.ComponentService,d.FovService,f.MapService,_.SystemService])],g),e.AiSystem=g},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=function(t){return function(e){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return n.forEach(function(n){return t.bind(n).toService(e)})}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(2);e.postConstruct=function(){return function(t,e,n){var s=new o.Metadata(r.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(r.POST_CONSTRUCT,t.constructor))throw new Error(i.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(r.POST_CONSTRUCT,s,t.constructor)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(6);e.targetName=function(t){return function(e,n,s){var a=new r.Metadata(i.NAME_TAG,t);o.tagParameter(e,n,s,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(6);e.multiInject=function(t){return function(e,n,s){var a=new r.Metadata(i.MULTI_INJECT_TAG,t);"number"==typeof s?o.tagParameter(e,n,s,a):o.tagProperty(e,n,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(6);e.unmanaged=function(){return function(t,e,n){var s=new r.Metadata(i.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(6);e.optional=function(){return function(t,e,n){var s=new r.Metadata(i.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(t,e,n,s):o.tagProperty(t,e,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(6);e.named=function(t){return function(e,n,s){var a=new r.Metadata(i.NAMED_TAG,t);"number"==typeof s?o.tagParameter(e,n,s,a):o.tagProperty(e,n,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(6);e.tagged=function(t,e){return function(n,o,s){var a=new i.Metadata(t,e);"number"==typeof s?r.tagParameter(n,o,s,a):r.tagProperty(n,o,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(0);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(r.PARAM_TYPES,t))throw new Error(i.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(r.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(r.PARAM_TYPES,e,t),t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=function(){return function(t){this.guid=i.guid(),this.registry=t}}();e.ContainerModule=r;var o=function(){return function(t){this.guid=i.guid(),this.registry=t}}();e.AsyncContainerModule=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null===t||void 0===t)throw new Error(i.NULL_ARGUMENT);if(null===e||void 0===e)throw new Error(i.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null===t||void 0===t)throw new Error(i.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(i.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null===t||void 0===t)throw new Error(i.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(i.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach(function(n,i){var r=n.filter(function(e){return!t(e)});r.length>0?e._map.set(i,r):e._map.delete(i)})},t.prototype.hasKey=function(t){if(null===t||void 0===t)throw new Error(i.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach(function(t,n){t.forEach(function(t){return e.add(n,t.clone())})}),e},t.prototype.traverse=function(t){this._map.forEach(function(e,n){t(n,e)})},t}();e.Lookup=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.of=function(e,n){var i=new t;return i.bindings=e,i.middleware=n,i},t}();e.ContainerSnapshot=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),r=n(37),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=i.BindingScopeEnum.Request,new r.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=i.BindingScopeEnum.Singleton,new r.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=i.BindingScopeEnum.Transient,new r.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(76),r=n(23),o=n(22),s=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding),this._bindingInSyntax=new i.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(4),o=n(77),s=n(37),a=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=r.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+i.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=r.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=r.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=r.BindingTypeEnum.Constructor,this._binding.implementationType=t,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=r.BindingTypeEnum.Factory,this._binding.factory=t,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw new Error(i.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=r.BindingTypeEnum.Function,e},t.prototype.toAutoFactory=function(t){return this._binding.type=r.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},new s.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=r.BindingTypeEnum.Provider,this._binding.provider=t,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue(function(e){return e.container.get(t)})},t}();e.BindingToSyntax=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(4),o=n(0);e.resolveInstance=function(t,e,n){var s=null;return s=e.length>0?function(t,e,n){var i=e.filter(function(t){return null!==t.target&&t.target.type===r.TargetTypeEnum.ClassProperty}),o=i.map(n);return i.forEach(function(e,n){var i;i=e.target.name.value();var r=o[n];t[i]=r}),t}(s=function(t,e){return new(t.bind.apply(t,[void 0].concat(e)))}(t,e.filter(function(t){return null!==t.target&&t.target.type===r.TargetTypeEnum.ConstructorArgument}).map(n)),e,n):new t,function(t,e){if(Reflect.hasMetadata(o.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(o.POST_CONSTRUCT,t);try{e[n.value]()}catch(e){throw new Error(i.POST_CONSTRUCT_ERROR(t.name,e.message))}}}(t,s),s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(4),o=n(40),s=n(10),a=n(79),c=function(t,e,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(i.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):n}},u=function(t){return function(e){e.parentContext.setCurrentRequest(e);var n=e.bindings,o=e.childRequests,h=e.target&&e.target.isArray(),l=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(h&&l)return o.map(function(e){return u(t)(e)});var p=null;if(!e.target.isOptional()||0!==n.length){var d=n[0],f=d.scope===r.BindingScopeEnum.Singleton,_=d.scope===r.BindingScopeEnum.Request;if(f&&d.activated)return d.cache;if(_&&null!==t&&t.has(d.guid))return t.get(d.guid);if(d.type===r.BindingTypeEnum.ConstantValue)p=d.cache;else if(d.type===r.BindingTypeEnum.Function)p=d.cache;else if(d.type===r.BindingTypeEnum.Constructor)p=d.implementationType;else if(d.type===r.BindingTypeEnum.DynamicValue&&null!==d.dynamicValue)p=c("toDynamicValue",d.serviceIdentifier,function(){return d.dynamicValue(e.parentContext)});else if(d.type===r.BindingTypeEnum.Factory&&null!==d.factory)p=c("toFactory",d.serviceIdentifier,function(){return d.factory(e.parentContext)});else if(d.type===r.BindingTypeEnum.Provider&&null!==d.provider)p=c("toProvider",d.serviceIdentifier,function(){return d.provider(e.parentContext)});else{if(d.type!==r.BindingTypeEnum.Instance||null===d.implementationType){var g=s.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(i.INVALID_BINDING_TYPE+" "+g)}p=a.resolveInstance(d.implementationType,o,u(t))}return"function"==typeof d.onActivation&&(p=d.onActivation(e.parentContext,p)),f&&(d.cache=p,d.activated=!0),_&&null!==t&&!t.has(d.guid)&&t.set(d.guid,p),p}}};e.resolve=function(t){return u(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=function(){function t(t,e,n,r,o){this.guid=i.guid(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,i){var r=new t(e,this.parentContext,this,n,i);return this.childRequests.push(r),r},t}();e.Request=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(39),r=n(1),o=n(4),s=n(0),a=n(10);e.getFunctionName=a.getFunctionName;var c=n(38);function u(t,e,n,i){var s=t.getConstructorMetadata(n),a=s.compilerGeneratedMetadata;if(void 0===a){var u=r.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(u)}var p=s.userGeneratedMetadata,d=Object.keys(p),f=function(t,e,n,i,r){for(var o=[],s=0;s<r;s++){var a=s,c=h(a,t,e,n,i);null!==c&&o.push(c)}return o}(i,e,a,p,0===n.length&&d.length>0?d.length:n.length),_=function t(e,n){var i=e.getPropertiesMetadata(n);var r=[];var s=Object.keys(i);for(var a=0,u=s;a<u.length;a++){var h=u[a],p=i[h],d=l(i[h]),f=d.targetName||h,_=d.inject||d.multiInject,g=new c.Target(o.TargetTypeEnum.ClassProperty,f,_);g.metadata=p,r.push(g)}var y=Object.getPrototypeOf(n.prototype).constructor;if(y!==Object){var m=t(e,y);r=r.concat(m)}return r}(t,n);return f.concat(_)}function h(t,e,n,s,a){var u=a[t.toString()]||[],h=l(u),p=!0!==h.unmanaged,d=s[t],f=h.inject||h.multiInject;if((d=f||d)instanceof i.LazyServiceIdentifer&&(d=d.unwrap()),p){var _=d===Object,g=d===Function;if(!e&&(_||g||void 0===d)){var y=r.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".";throw new Error(y)}var m=new c.Target(o.TargetTypeEnum.ConstructorArgument,h.targetName,d);return m.metadata=u,m}return null}function l(t){var e={};return t.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[s.INJECT_TAG],multiInject:e[s.MULTI_INJECT_TAG],targetName:e[s.NAME_TAG],unmanaged:e[s.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return u(t,a.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,n){var i=Object.getPrototypeOf(n.prototype).constructor;if(i!==Object){var r=u(e,a.getFunctionName(i),i,!0),o=r.map(function(t){return t.metadata.filter(function(t){return t.key===s.UNMANAGED_TAG})}),c=[].concat.apply([],o).length,h=r.length-c;return h>0?h:t(e,i)}return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){return function(t,e){this.parentContext=t,this.rootRequest=e}}();e.Plan=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=function(){function t(t){this.guid=i.guid(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(86),r=n(1),o=n(4),s=n(0),a=n(40),c=n(10),u=n(85),h=n(2),l=n(84),p=n(83),d=n(81),f=n(38);function _(t){return t._bindingDictionary}function g(t,e,n,o,s){var a=y(n.container,s.serviceIdentifier),u=[];return a.length===i.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof s.serviceIdentifier&&t.getConstructorMetadata(s.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(s.serviceIdentifier).toSelf(),a=y(n.container,s.serviceIdentifier)),u=e?a:a.filter(function(t){var e=new d.Request(t.serviceIdentifier,n,o,t,s);return t.constraint(e)}),function(t,e,n,o){switch(e.length){case i.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var s=c.getServiceIdentifierAsString(t),a=r.NOT_REGISTERED;throw a+=c.listMetadataForTarget(s,n),a+=c.listRegisteredBindingsForServiceIdentifier(o,s,y),new Error(a);case i.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case i.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;var s=c.getServiceIdentifierAsString(t),a=r.AMBIGUOUS_MATCH+" "+s;throw a+=c.listRegisteredBindingsForServiceIdentifier(o,s,y),new Error(a)}}(s.serviceIdentifier,u,s,n.container),u}function y(t,e){var n=[],i=_(t);return i.hasKey(e)?n=i.get(e):null!==t.parent&&(n=y(t.parent,e)),n}e.getBindingDictionary=_,e.plan=function(t,e,n,i,_,y,m,v){void 0===v&&(v=!1);var T=new u.Context(e),S=function(t,e,n,i,r,o){var a=t?s.MULTI_INJECT_TAG:s.INJECT_TAG,c=new h.Metadata(a,n),u=new f.Target(e,i,n,c);if(void 0!==r){var l=new h.Metadata(r,o);u.metadata.push(l)}return u}(n,i,_,"",y,m);try{return function t(e,n,i,s,a,c){var u,h;if(null===a){u=g(e,n,s,null,c),h=new d.Request(i,s,null,u,c);var f=new l.Plan(s,h);s.addPlan(f)}else u=g(e,n,s,a,c),h=a.addChildRequest(c.serviceIdentifier,u,c);u.forEach(function(n){var i=null;if(c.isArray())i=h.addChildRequest(n.serviceIdentifier,n,c);else{if(n.cache)return;i=h}if(n.type===o.BindingTypeEnum.Instance&&null!==n.implementationType){var a=p.getDependencies(e,n.implementationType);if(!s.container.options.skipBaseClassChecks){var u=p.getBaseClassDependencyCount(e,n.implementationType);if(a.length<u){var l=r.ARGUMENTS_LENGTH_MISMATCH(p.getFunctionName(n.implementationType));throw new Error(l)}}a.forEach(function(n){t(e,!1,n.serviceIdentifier,s,i,n)})}})}(t,v,_,T,null,S),T}catch(t){throw a.isStackOverflowExeption(t)&&T.plan&&c.circularDependencyToException(T.plan.rootRequest),t}},e.createMockRequest=function(t,e,n,i){var r=new f.Target(o.TargetTypeEnum.Variable,"",e,new h.Metadata(n,i)),s=new u.Context(t);return new d.Request(e,s,null,[],r)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),r=n(7),o=function(){function t(t,e){this.guid=r.guid(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=i.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}c((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=i[2&o[0]?"return":o[0]?"throw":"next"])&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[0,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(88),s=n(1),a=n(4),c=n(0),u=n(41),h=n(87),l=n(80),p=n(78),d=n(7),f=n(10),_=n(75),g=n(74),y=function(){function t(t){var e=t||{};if("object"!=typeof e)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=a.BindingScopeEnum.Transient;else if(e.defaultScope!==a.BindingScopeEnum.Singleton&&e.defaultScope!==a.BindingScopeEnum.Transient&&e.defaultScope!==a.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.guid=d.guid(),this._bindingDictionary=new g.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new u.MetadataReader}return t.merge=function(e,n){var i=new t,r=h.getBindingDictionary(i),o=h.getBindingDictionary(e),s=h.getBindingDictionary(n);function a(t,e){t.traverse(function(t,n){n.forEach(function(t){e.add(t.serviceIdentifier,t.clone())})})}return a(o,r),a(s,r),i},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),i=0,r=t;i<r.length;i++){var o=r[i],s=n(o.guid);o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i(this,void 0,void 0,function(){var e,n,i,o,s;return r(this,function(r){switch(r.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,i=t,r.label=1;case 1:return n<i.length?(o=i[n],s=e(o.guid),[4,o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)]):[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach(function(e){var n=function(t){return function(e){return e.moduleId===t}}(e.guid);t._bindingDictionary.removeByCondition(n)})},t.prototype.bind=function(t){var e=this.options.defaultScope||a.BindingScopeEnum.Transient,n=new o.Binding(t,e);return this._bindingDictionary.add(t,n),new p.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(s.CANNOT_UNBIND+" "+f.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new g.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,c.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var i=!1;if(this._bindingDictionary.hasKey(t)){var r=this._bindingDictionary.get(t),o=h.createMockRequest(this,t,e,n);i=r.some(function(t){return t.constraint(o)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(t,e,n)),i},t.prototype.snapshot=function(){this._snapshots.push(_.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce(function(t,e){return e(t)},n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,a.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,a.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,c.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,a.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,a.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,c.NAMED_TAG,e)},t.prototype.resolve=function(e){var n=new t;return n.bind(e).toSelf(),n.parent=this,n.get(e)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e};return function(n){return{bindFunction:function(n){return function(i){var r=t.bind.bind(t)(i);return e(r,n),r}}(n),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:function(n){return function(i){var r=t.rebind.bind(t)(i);return e(r,n),r}}(n),unbindFunction:function(e){t.unbind.bind(t)(e)}}}},t.prototype._get=function(t,e,n,i,r,o){var a=null,c={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:r,serviceIdentifier:i,targetType:n,value:o};if(this._middleware){if(void 0===(a=this._middleware(c))||null===a)throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(c);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=h.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),l.resolve(n)}},t}();e.Container=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(24),r=n(5).container.get("ComponentService");e.characterScreen=function(t,e,n,o,s){const a=Math.floor(o/2-n/2);let c=Math.floor(s/2-13.5);t.drawText(a,c,"Character information");const u=r.getComponentByEntityIdAndType(e.id,"LevelComponent");u&&(c++,t.drawText(a,c,`Level: ${u.currentLevel}`),c++,t.drawText(a,c,`Experience: ${u.currentXp}/${i.LevelComponent.xpToLevel(u)}`));const h=r.getComponentByEntityIdAndType(e.id,"FighterComponent");h&&(c+=2,t.drawText(a,c,`Maximum HP: ${h.baseMaxHp}`),c++,t.drawText(a,c,`Attack: ${h.basePower}`),c++,t.drawText(a,c,`Defense: ${h.baseDefense}`))}},function(t,e,n){(function(t,e){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;!function(n){!function(i){var r="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=s(n);function s(t,e){return function(n,i){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:i}),e&&e(n,i)}}void 0===r.Reflect?r.Reflect=n:o=s(r.Reflect,o),function(e){var n=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,r=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,a={__proto__:[]}instanceof Array,c=!s&&!a,u={create:s?function(){return D(Object.create(null))}:a?function(){return D({__proto__:null})}:function(){return D({})},has:c?function(t,e){return n.call(t,e)}:function(t,e){return e in t},get:c?function(t,e){return n.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},h=Object.getPrototypeOf(Function),l="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,p=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var i=this._keys.length,r=n+1;r<i;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,i)},e.prototype.values=function(){return new n(this._keys,this._values,r)},e.prototype.entries=function(){return new n(this._keys,this._values,s)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function i(t,e){return t}function r(t,e){return e}function s(t,e){return[t,e]}}():Map,d=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new p}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()},t}():Set,f=new(l||"function"!=typeof WeakMap?function(){var t=16,e=u.create(),i=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=o(t,!1);return void 0!==e&&u.has(e,this._key)},t.prototype.get=function(t){var e=o(t,!1);return void 0!==e?u.get(e,this._key):void 0},t.prototype.set=function(t,e){var n=o(t,!0);return n[this._key]=e,this},t.prototype.delete=function(t){var e=o(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var t;do{t="@@WeakMap@@"+a()}while(u.has(e,t));return e[t]=!0,t}function o(t,e){if(!n.call(t,i)){if(!e)return;Object.defineProperty(t,i,{value:u.create()})}return t[i]}function s(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function a(){var e=function(t){if("function"==typeof Uint8Array)return"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t);return s(new Array(t),t)}(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",i=0;i<t;++i){var r=e[i];4!==i&&6!==i&&8!==i||(n+="-"),r<16&&(n+="0"),n+=r.toString(16).toLowerCase()}return n}}():WeakMap);function _(t,e,n){var i=f.get(t);if(S(i)){if(!n)return;i=new p,f.set(t,i)}var r=i.get(e);if(S(r)){if(!n)return;r=new p,i.set(e,r)}return r}function g(t,e,n){var i=_(e,n,!1);return!S(i)&&function(t){return!!t}(i.has(t))}function y(t,e,n){var i=_(e,n,!1);if(!S(i))return i.get(t)}function m(t,e,n,i){var r=_(n,i,!0);r.set(t,e)}function v(t,e){var n=[],i=_(t,e,!1);if(S(i))return n;for(var r=i.keys(),s=function(t){var e=N(t,o);if(!C(e))throw new TypeError;var n=e.call(t);if(!E(n))throw new TypeError;return n}(r),a=0;;){var c=R(s);if(!c)return n.length=a,n;var u=I(c);try{n[a]=u}catch(t){try{x(s)}finally{throw t}}a++}}function T(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function S(t){return void 0===t}function w(t){return null===t}function E(t){return"object"==typeof t?null!==t:"function"==typeof t}function M(t,e){switch(T(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",i=N(t,r);if(void 0!==i){var o=i.call(t,n);if(E(o))throw new TypeError;return o}return function(t,e){if("string"===e){var n=t.toString;if(C(n)){var i=n.call(t);if(!E(i))return i}var r=t.valueOf;if(C(r)){var i=r.call(t);if(!E(i))return i}}else{var r=t.valueOf;if(C(r)){var i=r.call(t);if(!E(i))return i}var o=t.toString;if(C(o)){var i=o.call(t);if(!E(i))return i}}throw new TypeError}(t,"default"===n?"number":n)}function b(t){var e=M(t,3);return function(t){return"symbol"==typeof t}(e)?e:function(t){return""+t}(e)}function A(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function C(t){return"function"==typeof t}function O(t){return"function"==typeof t}function N(t,e){var n=t[e];if(void 0!==n&&null!==n){if(!C(n))throw new TypeError;return n}}function I(t){return t.value}function R(t){var e=t.next();return!e.done&&e}function x(t){var e=t.return;e&&e.call(t)}function P(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===h)return e;if(e!==h)return e;var n=t.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return e;var r=i.constructor;return"function"!=typeof r?e:r===t?e:r}function D(t){return t.__=void 0,delete t.__,t}e("decorate",function(t,e,n,i){if(S(n)){if(!A(t))throw new TypeError;if(!O(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var i=t[n],r=i(e);if(!S(r)&&!w(r)){if(!O(r))throw new TypeError;e=r}}return e}(t,e)}if(!A(t))throw new TypeError;if(!E(e))throw new TypeError;if(!E(i)&&!S(i)&&!w(i))throw new TypeError;return w(i)&&(i=void 0),n=b(n),function(t,e,n,i){for(var r=t.length-1;r>=0;--r){var o=t[r],s=o(e,n,i);if(!S(s)&&!w(s)){if(!E(s))throw new TypeError;i=s}}return i}(t,e,n,i)}),e("metadata",function(t,e){return function(n,i){if(!E(n))throw new TypeError;if(!S(i)&&!function(t){switch(T(t)){case 3:case 4:return!0;default:return!1}}(i))throw new TypeError;m(t,e,n,i)}}),e("defineMetadata",function(t,e,n,i){if(!E(n))throw new TypeError;S(i)||(i=b(i));return m(t,e,n,i)}),e("hasMetadata",function(t,e,n){if(!E(e))throw new TypeError;S(n)||(n=b(n));return function t(e,n,i){var r=g(e,n,i);if(r)return!0;var o=P(n);if(!w(o))return t(e,o,i);return!1}(t,e,n)}),e("hasOwnMetadata",function(t,e,n){if(!E(e))throw new TypeError;S(n)||(n=b(n));return g(t,e,n)}),e("getMetadata",function(t,e,n){if(!E(e))throw new TypeError;S(n)||(n=b(n));return function t(e,n,i){var r=g(e,n,i);if(r)return y(e,n,i);var o=P(n);if(!w(o))return t(e,o,i);return}(t,e,n)}),e("getOwnMetadata",function(t,e,n){if(!E(e))throw new TypeError;S(n)||(n=b(n));return y(t,e,n)}),e("getMetadataKeys",function(t,e){if(!E(t))throw new TypeError;S(e)||(e=b(e));return function t(e,n){var i=v(e,n);var r=P(e);if(null===r)return i;var o=t(r,n);if(o.length<=0)return i;if(i.length<=0)return o;var s=new d;var a=[];for(var c=0,u=i;c<u.length;c++){var h=u[c],l=s.has(h);l||(s.add(h),a.push(h))}for(var p=0,f=o;p<f.length;p++){var h=f[p],l=s.has(h);l||(s.add(h),a.push(h))}return a}(t,e)}),e("getOwnMetadataKeys",function(t,e){if(!E(t))throw new TypeError;S(e)||(e=b(e));return v(t,e)}),e("deleteMetadata",function(t,e,n){if(!E(e))throw new TypeError;S(n)||(n=b(n));var i=_(e,n,!1);if(S(i))return!1;if(!i.delete(t))return!1;if(i.size>0)return!0;var r=f.get(e);return r.delete(n),r.size>0||(f.delete(e),!0)})}(o)}()}(n||(n={}))}).call(this,n(43),n(42))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(91),n(11).main()}]);
//# sourceMappingURL=app.js.map